<!doctype html><html lang=zh-cn><head><meta charset=utf-8><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><title>golang web audit å°è®° - zznQ</title><meta name=author content="zznq"><meta property="og:title" content="golang web audit å°è®°"><meta property="og:description" content="ç®€å•è®°å½•ä¸‹Golang webä»£ç å®¡è®¡ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://zznq.imipy.com/posts/golang-web-audit/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-25T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-25T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="golang web audit å°è®°"><meta name=twitter:description content="ç®€å•è®°å½•ä¸‹Golang webä»£ç å®¡è®¡ã€‚"><link rel=stylesheet href=/style.min.5297c96c59a52afaa5bcda4a6cedf3813081f64025c209b25b2ee6d0c8f74d462b625ad3404a92a14d7a51b4ec0a420337ae70f426fa4bce2d5f7459a3ca7274.css integrity="sha512-UpfJbFmlKvqlvNpKbO3zgTCB9kAlwgmyWy7m0Mj3TUYrYlrTQEqSoU16UbTsCkIDN65w9Cb6S84tX3RZo8pydA=="><script>localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")</script><script defer src=/js/header.7a2a109ec3782c57bad0332b662f8a5f41765505936b69868eb8bd5241de9daf23c388e82ca1831f6d09935013dcb9f71bfa7face3975880c1076028b7b0a6e1.js integrity="sha512-eioQnsN4LFe60DMrZi+KX0F2VQWTa2mGjri9UkHena8jw4joLKGDH20Jk1AT3Ln3G/p/rOOXWIDBB2Aot7Cm4Q=="></script>
<script defer src=/js/builtin-copy.56e07a74dd440b068ab36af35542ed8960865686c19fb809f38436877ac081570612cc8a913650b0c0e3073a336680c5df960e73bf7b1de83dc6aa996f2db858.js integrity="sha512-VuB6dN1ECwaKs2rzVULtiWCGVobBn7gJ84Q2h3rAgVcGEsyKkTZQsMDjBzozZoDF35YOc797Heg9xqqZby24WA=="></script>
<script defer src=/js/search-zh-cn.677e05c714f837051483647d736c45051126c22a2696ca5f981b59da962d48962f3ea71150f559ba84884fd1aadf1c7aadce55bb31a3e5b75c0f173b763c109a.js integrity="sha512-Z34FxxT4NwUUg2R9c2xFBREmwiomlspfmBtZ2pYtSJYvPqcRUPVZuoSIT9Gq3xx6rc5VuzGj5bdcDxc7djwQmg=="></script></head><body><main><header><div class=brand><div id=sidebar_btn><svg id="menu_icon" width="26" height="26" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></svg></div><div><a href=/>zznQğŸˆ</a></div></div><div class=toolbox><div id=theme_tool><svg id="dark_mode_btn" class="hidden toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></svg><svg id="light_mode_btn" class="hidden toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></svg></div><div id=search_tool><svg id="search_btn" class="toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></svg><div id=search_menu_wrapper class=hidden><div id=search_menu><div id=search_menu_toolbar><div id=search_menu_input_wrapper><input id=search_menu_input type=text placeholder="Search Posts"></div><div id=search_menu_close_btn><svg width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></svg></div></div><div id=search_menu_results></div></div></div></div></div></header><nav id=navbar class=pure-menu><ul class=pure-menu-list><li class="navbar-item pure-menu-item insection"><a href=/posts/ class=pure-menu-link>æ–‡ç« </a></li><li class="navbar-item pure-menu-item"><a href=/categories/ class=pure-menu-link>åˆ†ç±»</a></li><li class="navbar-item pure-menu-item"><a href=/tags/ class=pure-menu-link>æ ‡ç­¾</a></li></ul></nav><div id=sidebar_canvas_overlay class=hidden></div><div id=sidebar class=close><ul><li><a href=/posts/>æ–‡ç« </a></li><li><a href=/categories/>åˆ†ç±»</a></li><li><a href=/tags/>æ ‡ç­¾</a></li></ul></div><div id=content class=content-margin><details class=collapsible-menu-wrapper><summary class=collapsible-menu-type><span>Table of contents</span></summary><div class=collapsible-menu><nav id=TableOfContents><ul><li><a href=#sqli>SQLI</a><ul><li><a href=#mysql>MySQL</a></li></ul></li><li><a href=#xss>XSS</a></li><li><a href=#csrf>CSRF</a></li><li><a href=#ç›®å½•éå†>ç›®å½•éå†</a><ul><li><a href=#gin>gin</a></li></ul></li><li><a href=#å‘½ä»¤æ‰§è¡Œ>å‘½ä»¤æ‰§è¡Œ</a></li><li><a href=#ä»£ç æ‰§è¡Œ>ä»£ç æ‰§è¡Œ</a></li><li><a href=#jsonpåŠ«æŒ>JsonpåŠ«æŒ</a><ul><li><a href=#å¦‚ä½•è‡ªåŠ¨åŒ–æ£€æµ‹>å¦‚ä½•è‡ªåŠ¨åŒ–æ£€æµ‹ï¼Ÿ</a></li></ul></li></ul></nav></div></details><div class=content-margin><article class=line-numbers><p>ç®€å•è®°å½•ä¸‹Golang webä»£ç å®¡è®¡ã€‚</p><h2 id=sqli>SQLI</h2><p><a href=https://golang.org/pkg/database/sql/>&ldquo;database/sql&rdquo;</a> åªæ˜¯ä¸€ä¸ªSQLæ•°æ®åº“çš„é€šç”¨æ¥å£ï¼Œå¿…é¡»è¦ä¸æ•°æ®åº“é©±åŠ¨ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚</p><p>æ”¯æŒçš„æ•°æ®åº“é©±åŠ¨åˆ—è¡¨ï¼šhttps://github.com/golang/go/wiki/SQLDrivers</p><h3 id=mysql>MySQL</h3><p>star æœ€å¤šçš„ MySQL é©±åŠ¨ä¸º<a href=https://github.com/go-sql-driver/mysql>github.com/go-sql-driver/mysql</a>ï¼Œçœ‹ä¸‹ <a href=https://github.com/go-sql-driver/mysql/blob/master/connection.go>connection.go</a> æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªä¸»è¦å‡½æ•°ï¼š<code> Query(query string, args []driver.Value)</code> å’Œ <code>Exec(query string, args []driver.Value)</code>ï¼Œå¦‚ä½•è¿‡æ»¤å‚æ•°çš„ã€‚</p><p>é€šè¿‡åˆ¤æ–­ <code>len(args)</code> é•¿åº¦ï¼ŒåŒºåˆ†çº¯æ–‡æœ¬æ¨¡å¼è¿˜æ˜¯æ’å€¼æ¨¡å¼ï¼›æ’å€¼æ¨¡å¼æ—¶è¿›å…¥ <code>interpolateParams()</code> å‡½æ•°è¿‡æ»¤å‚æ•°</p><p>éå† <code>args</code> é€šè¿‡ç±»å‹æ–­è¨€åˆ†åˆ«è¿›è¡Œå‚æ•°å¤„ç†ï¼Œå¹¶åœ¨ <code>escapeBytesBackslash(buf, v []byte) []byte</code> å‡½æ•°ä¸­åˆå¯¹æ¯ä¸ªå­—ç¬¦è¿›è¡Œæ£€æŸ¥</p><p>è´´ä¸‹ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#75715e>// https://github.com/go-sql-driver/mysql/blob/b36cd86ebcb680d317f962679780f5877a0b91e1/connection.go#L198
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>mc</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>mysqlConn</span>) <span style=color:#a6e22e>interpolateParams</span>(<span style=color:#a6e22e>query</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> []<span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>Value</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Number of ? should be same to len(args)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Count</span>(<span style=color:#a6e22e>query</span>, <span style=color:#e6db74>&#34;?&#34;</span>) <span style=color:#f92672>!=</span> len(<span style=color:#a6e22e>args</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>ErrSkip</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mc</span>.<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>takeCompleteBuffer</span>()
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>query</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>arg</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>int64</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>AppendInt</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>uint64</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Handle uint64 explicitly because our custom ConvertValue emits unsigned values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>AppendUint</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>, <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>float64</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>AppendFloat</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>, <span style=color:#e6db74>&#39;g&#39;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>bool</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>v</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>IsZero</span>() {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#34;&#39;0000-00-00&#39;&#34;</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>appendDateTime</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>In</span>(<span style=color:#a6e22e>mc</span>.<span style=color:#a6e22e>cfg</span>.<span style=color:#a6e22e>Loc</span>))
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>RawMessage</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>mc</span>.<span style=color:#a6e22e>status</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>statusNoBackslashEscapes</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>escapeBytesBackslash</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>escapeBytesQuotes</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> []<span style=color:#66d9ef>byte</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#34;NULL&#34;</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#34;_binary&#39;&#34;</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>mc</span>.<span style=color:#a6e22e>status</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>statusNoBackslashEscapes</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>escapeBytesBackslash</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>				} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>escapeBytesQuotes</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>string</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>mc</span>.<span style=color:#a6e22e>status</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>statusNoBackslashEscapes</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>escapeStringBackslash</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>escapeStringQuotes</span>(<span style=color:#a6e22e>buf</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span> = append(<span style=color:#a6e22e>buf</span>, <span style=color:#e6db74>&#39;\&#39;&#39;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>ErrSkip</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>buf</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>4</span> &gt; <span style=color:#a6e22e>mc</span>.<span style=color:#a6e22e>maxAllowedPacket</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>driver</span>.<span style=color:#a6e22e>ErrSkip</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>buf</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/go-sql-driver/mysql/blob/b36cd86ebcb680d317f962679780f5877a0b91e1/utils.go#L692
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>escapeStringBackslash</span>(<span style=color:#a6e22e>buf</span> []<span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>v</span> <span style=color:#66d9ef>string</span>) []<span style=color:#66d9ef>byte</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pos</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>buf</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>buf</span> = <span style=color:#a6e22e>reserveBuffer</span>(<span style=color:#a6e22e>buf</span>, len(<span style=color:#a6e22e>v</span>)<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>v</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>v</span>[<span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>c</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;\x00&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;0&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;\n&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;n&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;\r&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;r&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;\x1a&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;Z&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;\&#39;&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;\&#39;&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;&#34;&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;&#34;&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;\\&#39;</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] = <span style=color:#e6db74>&#39;\\&#39;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>buf</span>[<span style=color:#a6e22e>pos</span>] = <span style=color:#a6e22e>c</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pos</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>buf</span>[:<span style=color:#a6e22e>pos</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ‰€ä»¥ä½¿ç”¨ <code>æ’å€¼æ¨¡å¼</code> è§„é¿å¤§å¤šæ•° SQL æ³¨å…¥ï¼Œç¦æ­¢ä½¿ç”¨ä¼ å…¥çš„å‚æ•°æ¥æ‹¼æ¥ SQL è¯­å¥ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨ <a href=https://github.com/go-gorm/gorm>gorm</a> è¯·æ³¨æ„ <a href=https://gorm.io/zh_CN/docs/security.html>https://gorm.io/zh_CN/docs/security.html</a> åˆ—å‡ºçš„å‡½æ•°ï¼Œä½¿ç”¨æ’å€¼æ¨¡å¼æˆ–è€…æ£€æµ‹è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„å‚æ•°ã€‚</p><h2 id=xss>XSS</h2><p>æ¨èé˜…è¯»è¿™ç‰‡æ–‡ç«  <a href=https://tech.meituan.com/2018/09/27/fe-security.html>https://tech.meituan.com/2018/09/27/fe-security.html</a></p><p>ä» golang åç«¯çš„è§’åº¦æ¥è¯´ï¼Œæ¸…æ¥šçŸ¥é“æ•°æ®æœ€åè½åœ¨å‰ç«¯ä½ç½®å¹¶åšå¥½ç›¸å¯¹åº”è½¬ä¹‰è§„åˆ™ã€‚</p><h2 id=csrf>CSRF</h2><p>æ¨èé˜…è¯»è¿™ç‰‡æ–‡ç«  <a href=https://tech.meituan.com/2018/10/11/fe-security-csrf.html>https://tech.meituan.com/2018/10/11/fe-security-csrf.html</a></p><h2 id=ç›®å½•éå†>ç›®å½•éå†</h2><h3 id=gin>gin</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Default</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Static</span>(<span style=color:#e6db74>&#34;/uploads&#34;</span>, <span style=color:#e6db74>&#34;./uploads&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;[Main] Gin engine error: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ¢ç©¶ä¸‹æ˜¯å¦å­˜åœ¨<strong>ç›®å½•éå†</strong>ï¼Œç¿»é˜…ä»£ç  static æœ€åå¤„ç†çš„æ˜¯è·¯ç”± <code>/uploads/*filepath</code>ï¼Œè·å–æ–‡ä»¶å <code>file := c.Param("filepath")</code> å¹¶æ‰“å¼€è·å–æ–‡ä»¶å†…å®¹ <code>f, err := fs.Open(file)</code></p><p>è´´ä¸‹ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>StaticFS</span>(<span style=color:#e6db74>&#34;/uploads&#34;</span>, <span style=color:#a6e22e>Dir</span>(<span style=color:#e6db74>&#34;./uploads&#34;</span>, <span style=color:#66d9ef>false</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>group</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RouterGroup</span>) <span style=color:#a6e22e>StaticFS</span>(<span style=color:#a6e22e>relativePath</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fs</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>FileSystem</span>) <span style=color:#a6e22e>IRoutes</span> {
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>handler</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>group</span>.<span style=color:#a6e22e>createStaticHandler</span>(<span style=color:#a6e22e>relativePath</span>, <span style=color:#a6e22e>fs</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// è·¯ç”±è§„åˆ™
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>urlPattern</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>relativePath</span>, <span style=color:#e6db74>&#34;/*filepath&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>group</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#a6e22e>urlPattern</span>, <span style=color:#a6e22e>handler</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>group</span>.<span style=color:#a6e22e>HEAD</span>(<span style=color:#a6e22e>urlPattern</span>, <span style=color:#a6e22e>handler</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// createStaticHandler ç”Ÿæˆé™æ€æ–‡ä»¶å¤„ç†è·¯ç”±
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>group</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RouterGroup</span>) <span style=color:#a6e22e>createStaticHandler</span>(<span style=color:#a6e22e>relativePath</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fs</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>FileSystem</span>) <span style=color:#a6e22e>HandlerFunc</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>absolutePath</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>group</span>.<span style=color:#a6e22e>calculateAbsolutePath</span>(<span style=color:#a6e22e>relativePath</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fileServer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StripPrefix</span>(<span style=color:#a6e22e>absolutePath</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>FileServer</span>(<span style=color:#a6e22e>fs</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>		<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>file</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Param</span>(<span style=color:#e6db74>&#34;filepath&#34;</span>)<span style=color:#75715e>// è·å–æ–‡ä»¶å
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// Check if file exists and/or if we have permission to access it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>file</span>) <span style=color:#75715e>// æ‰“å¼€æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fileServer</span>.<span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Writer</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>http</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Dir</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>d</span> <span style=color:#a6e22e>Dir</span>) <span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>File</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dir</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>d</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>dir</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>dir</span> = <span style=color:#e6db74>&#34;.&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fullName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>dir</span>, <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>FromSlash</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>Clean</span>(<span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>name</span>))) <span style=color:#75715e>// `Clean()` æ–¹æ³•çœ‹ï¼š https://golang.org/pkg/path/#Cleanã€‚
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>fullName</span>)
</span></span><span style=display:flex><span>	<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>f</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨çœ‹çœ‹æœ€åå¦‚ä½•æ‰“å¼€æ–‡ä»¶çš„ <code>fullName := filepath.Join(dir, filepath.FromSlash(path.Clean("/"+name)))</code> ä¸­çš„ <code>path.Clean("/"+name)</code> name å‰çš„ <code>/</code> å­—ç¬¦å¾ˆå…³é”®ï¼Œè®©ä¸€åˆ‡æ²¡æœ‰å¸Œæœ›ã€‚ã€‚ã€‚</p><p><img src=https://user-images.githubusercontent.com/26270009/119491681-c9972c00-bd90-11eb-9753-9baaca83c4a5.png alt=image></p><p>æƒ³è¦å®ç°é™æ€æ–‡ä»¶æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ golang <code>http.Dir</code> å¤„ç†ä¼ å…¥æ–‡ä»¶å‚æ•°ï¼Œé¿å…ç›®å½•éå†ã€‚</p><h2 id=å‘½ä»¤æ‰§è¡Œ>å‘½ä»¤æ‰§è¡Œ</h2><h2 id=ä»£ç æ‰§è¡Œ>ä»£ç æ‰§è¡Œ</h2><h2 id=jsonpåŠ«æŒ>JsonpåŠ«æŒ</h2><p>Jsonp(JSON with Padding)æ˜¯JSONçš„ä¸€ç§"ä½¿ç”¨æ¨¡å¼"ï¼Œå¯ä»¥è®©ç½‘é¡µä»åˆ«çš„åŸŸåï¼ˆç½‘ç«™ï¼‰é‚£è·å–èµ„æ–™ï¼Œå³<strong>è·¨åŸŸè¯»å–æ•°æ®</strong>ã€‚è®¾è®¡å‡ºæ¥å°±æ˜¯ä¸ºäº†è§£å†³<a href=https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy>åŒæºç­–ç•¥</a>çš„é™åˆ¶ã€‚</p><p>å†™ä¸ªç®€å• jsonp demoï¼š</p><p>server ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Default</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/jsonp&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;bar&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;desc&#34;</span>: <span style=color:#e6db74>&#34;desc..&#34;</span>,
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSONP</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>, <span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>client ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Jsonp Test&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>name</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>desc</span>);
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>	<span style=color:#75715e>&lt;!-- script --&gt;</span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://localhost:8080/jsonp?callback=log&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>	<span style=color:#75715e>&lt;!-- jquery --&gt;</span>
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>ready</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>ajax</span>({
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;get&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;http://localhost:8080/jsonp&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>dataType</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jsonp&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>jsonp</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;callback&#34;</span>,<span style=color:#75715e>//ä¼ é€’ç»™è¯·æ±‚å¤„ç†ç¨‹åºæˆ–é¡µé¢çš„ï¼Œç”¨ä»¥è·å¾—jsonpå›è°ƒå‡½æ•°åçš„å‚æ•°å(ä¸€èˆ¬é»˜è®¤ä¸º:callback)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>jsonpCallback</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;log&#34;</span>,<span style=color:#75715e>//è‡ªå®šä¹‰çš„jsonpå›è°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°åï¼Œä¹Ÿå¯ä»¥å†™&#34;?&#34;ï¼ŒjQueryä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>success</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>data</span>) {},
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> () {<span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#39;fail&#39;</span>);}
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><h3 id=å¦‚ä½•è‡ªåŠ¨åŒ–æ£€æµ‹>å¦‚ä½•è‡ªåŠ¨åŒ–æ£€æµ‹ï¼Ÿ</h3><p><a href=https://koalr.me/post/a-tour-of-xray/>a-tour-of-xray</a>è¿™ç¯‡åšå®¢ä¸­å·²ç»è¯¦ç»†ä»‹ç»äº†å¦‚ä½•æ‰‹å·¥æŒ–æ˜</p><p><img src=https://user-images.githubusercontent.com/26270009/121984526-b4c51b80-cdc5-11eb-8a58-377beaec845f.png alt=image></p><p>åœ¨â€œåˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯â€çš„éƒ¨åˆ†ä¹Ÿä¸æ˜¯é‡‡å–ç®€å•æ­£åˆ™åŒ¹é…å‘ç°æ•æ„Ÿä¿¡æ¯è€Œæ˜¯é‡‡ç”¨ASTè¯­ä¹‰åˆ†æã€‚æˆ‘åœ¨æ­¤ <a href=https://github.com/jweny/check_jsonp_based_on_ast>jweny - check_jsonp_based_on_ast</a> åŸºç¡€åšäº†æ·±åº¦ä¼˜åŒ–ï¼ŒçœŸæ­£çš„èƒ½æ£€æµ‹ç±»ä¼¼å¦‚ä¸‹jsè¯­å¥ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>callback</span>({<span style=color:#e6db74>&#34;data&#34;</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;jweny&#34;</span>}});
</span></span><span style=display:flex><span><span style=color:#a6e22e>callback</span>({<span style=color:#e6db74>&#34;data&#34;</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>a</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;jweny&#34;</span>,<span style=color:#a6e22e>test</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>:</span>[<span style=color:#e6db74>&#34;123&#34;</span>, <span style=color:#ae81ff>1</span>,{<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;xx&#34;</span>}]}});
</span></span><span style=display:flex><span><span style=color:#a6e22e>callback</span>([{<span style=color:#e6db74>&#34;info&#34;</span><span style=color:#f92672>:</span> {<span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jweny&#34;</span>}}])
</span></span><span style=display:flex><span><span style=color:#a6e22e>cb</span>(<span style=color:#e6db74>&#39;  {&#34;username&#34;:&#34;jweny&#34;}  &#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>/*aa*/</span> window.<span style=color:#a6e22e>cb</span>({<span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;jweny&#34;</span>})
</span></span><span style=display:flex><span><span style=color:#75715e>/*aa*/</span> window.<span style=color:#a6e22e>cb</span> <span style=color:#f92672>&amp;&amp;</span> window.<span style=color:#a6e22e>cb</span>({<span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;jweny&#34;</span>})
</span></span><span style=display:flex><span><span style=color:#75715e>/*aa*/</span> <span style=color:#a6e22e>cb</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>cb</span>({<span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;jweny&#34;</span>})
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span><span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jweny&#34;</span>}; <span style=color:#a6e22e>cb</span>({<span style=color:#e6db74>&#34;s&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>a</span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span><span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;username&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jweny&#34;</span>}; <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>a</span>);
</span></span></code></pre></div><p>ç›¸å…³æºç è´´åœ¨æ­¤ï¼šhttps://github.com/Buzz2d0/taser/blob/main/probe/jsonp.go</p></article><script src=https://utteranc.es/client.js repo=Buzz2d0/zznq issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div><footer><article>Copyright Â© 2019-2022 by zznq</article></footer></main></body></html>