[{"content":"åœ¨ç ´è§£Bartender4åæ²¡å¤šä¹…èºåŠ¨åœ°å¿ƒåˆå¼€å§‹äº†è¿™æ¬¡å°±å°è¯•ç ´è§£macOSä¸‹çš„Typoraï¼Œé¡ºä¾¿è®°å½•ä¸€ä¸‹ã€‚\næœç´¢ç›¸å…³æ–‡ç« çœ‹åˆ°æˆåŠŸç ´è§£ Winã€Linux(Electron)çš„æ–‡ç« ä»¥åŠå·¥å…·ï¼š https://blog.shi1011.cn/rev/1891 https://github.com/Mas0nShi/typoraCracker æ–‡ç« ä¸­åˆ†æï¼ˆwinï½œlinuxï¼‰addLicense æµç¨‹å¦‚ä¸‹ï¼ŒmacOS ä¸Šä½¿ç”¨åŸç”Ÿ webkit å¼€å‘ï¼Œä¼°è®¡æ€è·¯å·®ä¸å¤šï¼š\nç›´æ¥æ‰“å¼€ Hopper åˆ†ææœç´¢ License æ‰¾åˆ°äº† LicenseManager ç±»ï¼š\nçœ‹åˆ°ä¸€ä¸ªå…³é”®å­—ä¸º activate çš„æ–¹æ³•ï¼Œç­¾åå¦‚ä¸‹ï¼š\n/* @class LicenseManager */ -(void)activate:(void *)arg2 with:(void *)arg3 force:(char)arg4 callback:(void *)arg5 {  /* - arg2 -\u0026gt; email - arg3 -\u0026gt; license - arg4 -\u0026gt; force - arg5 -\u0026gt; callback */ åˆ†æ LicenseManager.activate å…¶æ–¹æ³•æµç¨‹ï¼š\nä½†æ˜¯æˆ‘ä¸çŸ¥é“ä¼ å…¥çš„ callback æ˜¯ä»€ä¹ˆï¼Œä¸ºäº†ææ¸…æ¥šæ•´ä¸ªæµç¨‹ï¼Œæƒ³ä½¿ç”¨ firda æ¥æ‰“å°ä¸‹activateä¼ å…¥çš„å‚æ•°ï¼š\n$ frida-trace -i \u0026#34;activate*\u0026#34; Typora Attaching... [1] 4229 killed frida-trace -i \u0026#34;activate*\u0026#34; Typora è¿›ç¨‹ç›´æ¥è¢«æ€æ‰äº† emmm ç®—é€‘ï¼ç»§ç»­é™æ€åˆ†æå§ã€‚\nï¼ˆwinï½œlinuxï¼‰ addLicense æµç¨‹ä¸­çš„æœ€åä¸€æ­¥å‡ºç°çš„ decryptå…³é”®å­—ï¼Œæ ¹æ®è¿™ä¸ªå…³é”®å­—æœç´¢åˆ°äº†æ ¸å¿ƒçš„åŠ è§£å¯† Crypto ç±»ï¼š\nä»¥åŠ\n/* @class LicenseManager */ -(char)verifySig:(void *)arg2 { æˆ‘çŒœæµ‹ callback å°±æ˜¯åˆ¤æ–­ responseï¼Œå°†å†…å®¹è§£å¯†å†å»éªŒè¯ license æˆåŠŸåè°ƒç”¨ writeLicenseInfoã€‚\né‚£ç ´è§£çš„æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼š\n  ä¿®æ”¹ [LicenseManager quickValidateLicense]ã€[Crypto verify] [LicenseManager verifySig] ä¸å»æ ¡éªŒè¿”å› trueã€‚\n  ç§»é™¤ sendPost ä¸­ç½‘ç»œè¯·æ±‚çš„éƒ¨åˆ†åå†™å…¥è¯ä¹¦ã€‚\n  æ±‡ç¼–å¤ªéš¾å•¦(èœæ˜¯åŸç½ª)ï¼Œä¿®æ”¹ä¹‹åä¸æ˜¯å¥”æºƒå°±æ˜¯hangä½ï¼ˆç¨‹åºhangç€çš„åŸå› å¯èƒ½æ˜¯å‰ç«¯ä¼ å…¥äº†äº‹ä»¶ç­‰å¾… callback è¿è¡Œå®Œæˆï¼‰ï¼Œå°±åœ¨æˆ‘å¿«è¦æ”¾å¼ƒçš„æ—¶å€™çœ‹åˆ°52pojieä¸Šä¸€ç¯‡ç ´è§£ 1.0 ç‰ˆæœ¬çš„æ–‡ç« ï¼ˆæ„Ÿè°¢å›½å…‰å¸ˆå‚…ç¾¤é‡Œçš„çƒ­å¿ƒå¸ˆå‚…ï¼‰ï¼šä¿®æ”¹[LicenseManager hasLicense] è¿”å›ä¸ºtrue ã€‚\nå…¶å®è¿™ä¸ªæ–¹æ³•æˆ‘ä¹‹å‰ä¹Ÿè¯•è¿‡äº†ï¼Œæ˜¾ç¤ºå·²ç»è¢«æ¿€æ´»ï¼š ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ä½¿å…¶åˆ°æœŸï¼ŒTyporaè½¯ä»¶è¿˜èƒ½ç”¨ï¼Œç‚¹å¼€Typora-\u0026gt;æˆ‘çš„è®¸å¯è¯ååªèƒ½é€€å‡ºï¼š æ–‡ç« ä¸­çš„æ€è·¯æ˜¯hook showLicense è®©å…¶å¼¹å‡ºå…¶ä»–çª—å£æˆ–è€…ä»€ä¹ˆä¸åšã€‚\né‚£æˆ‘å°±ç”¨è¿™ç§æ–¹æ³•å§ï¼Œåˆä¸æ˜¯ä¸èƒ½ç”¨ï½ğŸ¤ªã€‚\n ç¼–å†™ä¸€ä¸ªdylib hook [LicenseManager showLicense]ï¼ŒhasLicense æˆ‘å·²ç»ä½¿ç”¨ Hopper ä¿®æ”¹è¿‡äº†ã€‚\næ‰“å¼€ XCode åˆ›å»º macOS-Librayï¼š\næ–°å»º main.mæ–‡ä»¶ï¼š\n#import \u0026lt;Foundation/Foundation.h\u0026gt; #include \u0026lt;Cocoa/Cocoa.h\u0026gt;#import \u0026lt;objc/runtime.h\u0026gt; #import \u0026#34;hookHelper.h\u0026#34;  @interface NSObject (LicenseManager) + (void) hookLicenseManager; @end  @implementation NSObject (LicenseManager) - (void)hook_showLicense:(char)arg2 {  NSString *message = @\u0026#34;zznQ\u0026#34;;  NSAlert *alert = [NSAlert new];  [alert addButtonWithTitle:@\u0026#34;OK\u0026#34;];  [alert setMessageText:message];  [alert setAlertStyle:NSAlertStyleCritical];  [alert runModal]; }  + (void) hookLicenseManager {  NSLog(@\u0026#34;in hookLicenseManager\u0026#34;);  hookMethod(objc_getClass(\u0026#34;LicenseManager\u0026#34;),  @selector(showLicense:),  [self class],  @selector(hook_showLicense:)); } @end  static void __attribute__((constructor)) initialize(void) {  NSLog(@\u0026#34;hook typora!!!\u0026#34;);  [NSObject hookLicenseManager]; } hookHelper.h çš„ hookMethod å®ç°å¦‚ä¸‹ï¼š\nvoid hookMethod(Class originalClass, SEL originalSelector, Class swizzledClass, SEL swizzledSelector){  Method originalMethod = class_getInstanceMethod(originalClass, originalSelector);  Method swizzledMethod = class_getInstanceMethod(swizzledClass, swizzledSelector);  if (originalMethod \u0026amp;\u0026amp; swizzledMethod){  method_exchangeImplementations(originalMethod, swizzledMethod);  } } åœ¨M1æœºå™¨ä¸Šè®°å¾—å°† build active architecture only å‚æ•°æ”¹ä¸º Noï¼š\næˆ‘ä½¿ç”¨Hopper ä¿®æ”¹ Typora åå¯¼å‡º Binary ä¸º x86_64 ï¼Œè¿™é‡Œ dylib ä¹Ÿè¦ç˜¦èº«ä¸º x86_64ï¼ˆå¦‚æœä¸æ˜¯fat binary å°±è·³è¿‡ï¼‰ lipo libtyporahook.dylib -thin x86_64 -output libtyporahook_x86_64.dylib\nå°† libtyporahook_x86_64.dylib å’Œ Typora/Contents/MacOS/ ç›®å½•ä¸‹å’Œ Typora å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œè¿è¡Œinsert_dylib --all-yes @executable_path/libtyporahook_x86_64.dylib Typora å°±å¥½äº†ã€‚\n ","permalink":"https://zznq.imipy.com/posts/failed-to-crack-typora/","title":"è®°å½•ä¸€æ¬¡ç ´è§£[macOS]Typoraå¤±è´¥çš„ç»å†"},{"content":"å¦‚ä½•ä½¿ç”¨APIä¸»åŠ¨è§¦å‘ï¼Ÿ\nåœ¨ docs.github.com ä¸­æ‰¾åˆ°äº†æ‰‹åŠ¨è§¦å‘çš„æ¥å£ã€‚\n  åœ¨Github Settings å¤„ï¼ˆå³ https://github.com/settings/tokens ï¼‰ç”³è¯·Tokensï¼Œæ”¾ç½®API header ä¸­ Authorization: token {{your token}}\n  åœ¨ä»“åº“æ ¹ç›®å½•ä¸‹åˆ›å»º .github/workflows/heartbeat.yml æ–‡ä»¶ï¼š\n  name: HeartBeat  on:  workflow_dispatch:  inputs:  value:  description: \u0026#39;value\u0026#39;  required: false  jobs:  sync:  name: Build  runs-on: ubuntu-latest  steps:  - name: Test-on-01  run: | echo ${{ github.event.inputs.value }}  è¯·æ±‚æ¥å£ï¼ˆä»¥æˆ‘çš„ä»“åº“ä¸ºä¾‹ï¼‰ï¼š  curl \\  -X POST \\  -H \u0026#34;Accept: application/vnd.github.v3+json\u0026#34; \\  -H \u0026#34;Authorization: token xxxxxxxxx\u0026#34; \\  https://api.github.com/repos/Buzz2d0/Buzz2d0/actions/workflows/heartbeat.yml/dispatches \\  -d \u0026#39;{\u0026#34;ref\u0026#34;:\u0026#34;main\u0026#34;,\u0026#34;inputs\u0026#34;:{\u0026#34;value\u0026#34;:\u0026#34;66\u0026#34;}}\u0026#39; æµ‹è¯•é€šè¿‡âœ…åï¼Œå°±è¯•è¯•åœ¨IOSå¿«æ·æŒ‡ä»¤ä¸‹å®Œæˆæ›´æ–°å¿ƒç‡æ¨é€å§ï¼š\nåœ¨IOSå¿«æ·æŒ‡ä»¤ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡ä»¤ï¼ˆå¦‚ä¸‹å›¾ï¼š\nä¹‹åå¯ä»¥åœ¨è‡ªåŠ¨åŒ–ä¸­æ·»åŠ â€œå¼€å§‹æˆ–è€…ç»“æŸä»»æ„ä½“èƒ½è®­ç»ƒæ—¶â€è§¦å‘è¿™ä¸ªå¿«æ·æŒ‡ä»¤ã€‚\né™¤äº†ä¸Šé¢çš„åˆ—å‡ºçš„éƒ¨åˆ†ï¼Œæˆ‘å®Œå–„äº†ä¸€äº›å°ç»†èŠ‚ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹æˆ‘çš„ä»“åº“ https://github.com/Buzz2d0/Buzz2d0\n","permalink":"https://zznq.imipy.com/posts/ios-push-heartbeats-to-github-with-actions/","title":"IOSå¿«æ·æŒ‡ä»¤+Github Actionsæ›´æ–°å¿ƒç‡"},{"content":"çªç„¶æƒ³è§£å¯†ä¸‹ WeChat æœ¬åœ°èŠå¤©æ•°æ®åº“ ï¼Œè¿™äº› msg_*.db æ–‡ä»¶ä¸€èˆ¬å­˜åœ¨ ~/Library/Containers/com.tencent.xinWeChat/Data/Library/Application\\ Support/com.tencent.xinWeChat/2.*******/123812fsdhg1232333sd/Message/ ç›®å½•ä¸‹\ngoogle å‘ç°ä¸€ä¸ªæ•™ç¨‹ï¼šhttps://github.com/allen1881996/WeChat-Data-Analysis æµ‹è¯•åå‘ç°è¿™ä¸ªæ“ä½œæ˜¯å¯è¡Œçš„ã€‚å¤§æ¦‚æ­¥éª¤å¦‚ä¸‹ï¼šé€šè¿‡ lldb åŠ¨æ€è°ƒè¯•å¯¹ sqlite3_key å‡½æ•°æ–­ç‚¹åå†è¯»å– $rsi å¯„å­˜å™¨çš„å€¼ï¼Œè¿›è¡Œç®€å•æ‹¼æ¥å³å¾—åˆ°äº† sqlite3 raw-keyã€‚\nä½†æ˜¯å¿ƒä¸­å‡ºç°äº†ä¸¤ä¸ªç–‘é—®ï¼š\n ä¸ºä»€ä¹ˆæ˜¯ sqlite3_key?  Tencentæœ‰ä¸ªå¼€æºé¡¹ç›® wcdb æ˜¯åŸºäºSQLiteçš„ï¼ŒåŠ å¯†ä½¿ç”¨çš„æ˜¯å¼€æºçš„ SQLCipher sqlite3_key å‡½æ•°å°±æ˜¯è®¾ç½®åŠ å¯†æ•°æ®åº“çš„ã€‚wcdb å°†å…¶å°è£…åœ¨äº† setCipherKey æ–¹æ³•ä¸‹ã€‚\nmemory read --size 1 --format x --count 32 $rsi æ˜¯å•¥æ„æ€ï¼Ÿ  x86-64 ä¸­å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°å­˜å‚¨å¦‚ä¸‹å¯„å­˜å™¨ä¸­: %rdi, %rsi, %rdx, %rcx, %r8, %r9 å…­ä¸ªå¯„å­˜å™¨ç”¨äºå­˜å‚¨å‡½æ•°è°ƒç”¨æ—¶çš„6ä¸ªå‚æ•°ï¼ˆå¦‚æœæœ‰6ä¸ªæˆ–6ä¸ªä»¥ä¸Šå‚æ•°çš„è¯ï¼‰ã€‚\n%rsi å¯„å­˜å™¨å­˜å‚¨çš„ä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œå³å¯¹åº” int sqlite3_key(sqlite3 *db, const void *pKey, int nKey); ä¸­ key ã€‚\n å¦‚ä½•èƒ½é€šè¿‡é™æ€çš„æ–¹å¼è·å–åˆ° key å‘¢ï¼Ÿ æ ¹æ® WCDB çš„çº¿ç´¢ç»§ç»­æ‘¸ç´¢ï¼Œæ‰¾åˆ°åœ¨å“ªé‡Œæ‰§è¡Œ setCipherKey\næ‘¸ç´¢ wcdb çš„æ–‡æ¡£å‘ç°åŠ å¯†ï¼š\nWCTDatabase *database = [[WCTDatabase alloc] initWithPath:path]; NSData *password = [@\u0026#34;MyPassword\u0026#34; dataUsingEncoding:NSASCIIStringEncoding]; [database setCipherKey:password]; åœ¨ hopper Disassembler ä¸­æœç´¢ setCipherKey å¹¶æ²¡å•¥å‘ç°ï¼Œåªèƒ½æ¢ä¸ªæ€è·¯åœ¨ dump çš„å¤´æ–‡ä»¶æœ WCTDatabase å‘ç°å¾ˆå¤šéœ€è¦å­˜å‚¨çš„*DBç±»ä¸­éƒ½æœ‰ä¸ª WCTDatabase *m_db; åœ¨å¾€ä¸‹ç¿» - (BOOL)setupDB; è¿™ä¸€çœ‹å°±æ˜¯ç”¨æ¥åˆå§‹åŒ–æ•°æ®åº“ã€‚\næ‰¾åˆ° MessageDB.setupDB ä¸­å¯†é’¥æ˜¯ä» [WCDBHelper CipherKey] å¾—åˆ°çš„ï¼Œä¸‹é¢è´´ä¸ªä¼ªä»£ç ï¼š\n----WCDBHelper CipherKey---- +(void *)CipherKey { r14 = [[MMServiceCenter defaultCenter] retain]; rax = [AccountStorage class]; rax = [r14 getService:rax]; rax = [rax retain]; r13 = rax; rax = [rax GetDBEncryptInfo]; rax = [rax retain]; r15 = [[rax m_dbEncryptKey] retain]; ç®€åŒ–ä¸‹ï¼š[[AccountStorage GetDBEncryptInfo] m_dbEncryptKey]\nAccountStorage ä¸­æœ‰ä¸ª init æ–¹æ³•ï¼š\ndb setting æ–‡ä»¶è·¯å¾„ï¼š\nrax = [PathUtility GetAccountSettingDbPath]; rax = [rax retain]; rcx = *ivar_offset(m_dbEncryptInfoPath); ä½¿ç”¨ PBCoder ä»æ–‡ä»¶è§£ç  DBEncryptInfo\nrax = [PBCoder decodeObjectOfClass:[DBEncryptInfo class] fromFile:r14-\u0026gt;m_dbEncryptInfoPath]; pbcoding æ˜¯å•¥ï¼Ÿ\nhttps://github.com/Tencent/MMKV/issues/42#issuecomment-424976201 use protobuf protocol to archive/unarchive object.\nä»æ­¤å›ç­”ä¸­çŸ¥é“ pbcoding æ˜¯åŸºäº protobuf è¿›è¡Œå½’æ¡£å¯¹è±¡çš„ã€‚\nhook [PathUtility GetAccountSettingDbPath] æ‰¾åˆ°æ–‡ä»¶ä¸º ~/Library/Containers/com.tencent.xinWeChat/Data/Library/Application\\ Support/com.tencent.xinWeChat/2.***/123****1230000/Account/setting_db.data\nprotoc --decode_raw \u0026lt; setting_db.data æœ‰ä¸‰ä¸ªå±æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æ—¶é—´æˆ³ã€‚\nçœ‹äº†çœ‹ PBCoder decodeOneObject ä¼ªä»£ç ç ”ç©¶äº†å¥½ä¸€ä¼šå„¿ï¼Œè¿˜æ˜¯ä¸çŸ¥é“å¦‚ä½•ä»è¿™ä¸­è§£å‡ºæ•°æ®åº“å¯†ç \n ç²—ç³™çš„è®°å½•ä¸‹ï¼ŒçŸ­çŸ­çš„æµç¨‹ï¼Œå´ç ”ç©¶äº†ä¸¤å¤©ã€‚ã€‚ã€‚\n","permalink":"https://zznq.imipy.com/posts/wechat-sqlite-key/","title":"é€†å‘è·å– MacOS WeChat App èŠå¤©æ•°æ®åº“å¯†é’¥å°è®°"},{"content":"ç®€å•è®°å½•ä¸‹Golang webä»£ç å®¡è®¡ã€‚\nSQLI \u0026ldquo;database/sql\u0026rdquo; åªæ˜¯ä¸€ä¸ªSQLæ•°æ®åº“çš„é€šç”¨æ¥å£ï¼Œå¿…é¡»è¦ä¸æ•°æ®åº“é©±åŠ¨ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚\næ”¯æŒçš„æ•°æ®åº“é©±åŠ¨åˆ—è¡¨ï¼šhttps://github.com/golang/go/wiki/SQLDrivers\nMySQL star æœ€å¤šçš„ MySQL é©±åŠ¨ä¸ºgithub.com/go-sql-driver/mysqlï¼Œçœ‹ä¸‹ connection.go æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªä¸»è¦å‡½æ•°ï¼š Query(query string, args []driver.Value) å’Œ Exec(query string, args []driver.Value)ï¼Œå¦‚ä½•è¿‡æ»¤å‚æ•°çš„ã€‚\né€šè¿‡åˆ¤æ–­ len(args) é•¿åº¦ï¼ŒåŒºåˆ†çº¯æ–‡æœ¬æ¨¡å¼è¿˜æ˜¯æ’å€¼æ¨¡å¼ï¼›æ’å€¼æ¨¡å¼æ—¶è¿›å…¥ interpolateParams() å‡½æ•°è¿‡æ»¤å‚æ•°\néå† args é€šè¿‡ç±»å‹æ–­è¨€åˆ†åˆ«è¿›è¡Œå‚æ•°å¤„ç†ï¼Œå¹¶åœ¨ escapeBytesBackslash(buf, v []byte) []byte å‡½æ•°ä¸­åˆå¯¹æ¯ä¸ªå­—ç¬¦è¿›è¡Œæ£€æŸ¥\nè´´ä¸‹ä»£ç ï¼š\n// https://github.com/go-sql-driver/mysql/blob/b36cd86ebcb680d317f962679780f5877a0b91e1/connection.go#L198  func (mc *mysqlConn) interpolateParams(query string, args []driver.Value) (string, error) { \t// Number of ? should be same to len(args) \tif strings.Count(query, \u0026#34;?\u0026#34;) != len(args) { \treturn \u0026#34;\u0026#34;, driver.ErrSkip \t}  ... \tbuf, err := mc.buf.takeCompleteBuffer()  ... \tfor i := 0; i \u0026lt; len(query); i++ { \t... \tswitch v := arg.(type) { \tcase int64: \tbuf = strconv.AppendInt(buf, v, 10) \tcase uint64: \t// Handle uint64 explicitly because our custom ConvertValue emits unsigned values \tbuf = strconv.AppendUint(buf, v, 10) \tcase float64: \tbuf = strconv.AppendFloat(buf, v, \u0026#39;g\u0026#39;, -1, 64) \tcase bool: \tif v { \tbuf = append(buf, \u0026#39;1\u0026#39;) \t} else { \tbuf = append(buf, \u0026#39;0\u0026#39;) \t} \tcase time.Time: \tif v.IsZero() { \tbuf = append(buf, \u0026#34;\u0026#39;0000-00-00\u0026#39;\u0026#34;...) \t} else { \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \tbuf, err = appendDateTime(buf, v.In(mc.cfg.Loc)) \tif err != nil { \treturn \u0026#34;\u0026#34;, err \t} \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \t} \tcase json.RawMessage: \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \tif mc.status\u0026amp;statusNoBackslashEscapes == 0 { \tbuf = escapeBytesBackslash(buf, v) \t} else { \tbuf = escapeBytesQuotes(buf, v) \t} \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \tcase []byte: \tif v == nil { \tbuf = append(buf, \u0026#34;NULL\u0026#34;...) \t} else { \tbuf = append(buf, \u0026#34;_binary\u0026#39;\u0026#34;...) \tif mc.status\u0026amp;statusNoBackslashEscapes == 0 { \tbuf = escapeBytesBackslash(buf, v) \t} else { \tbuf = escapeBytesQuotes(buf, v) \t} \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \t} \tcase string: \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \tif mc.status\u0026amp;statusNoBackslashEscapes == 0 { \tbuf = escapeStringBackslash(buf, v) \t} else { \tbuf = escapeStringQuotes(buf, v) \t} \tbuf = append(buf, \u0026#39;\\\u0026#39;\u0026#39;) \tdefault: \treturn \u0026#34;\u0026#34;, driver.ErrSkip \t}  \tif len(buf)+4 \u0026gt; mc.maxAllowedPacket { \treturn \u0026#34;\u0026#34;, driver.ErrSkip \t} \t} \treturn string(buf), nil }  ... // https://github.com/go-sql-driver/mysql/blob/b36cd86ebcb680d317f962679780f5877a0b91e1/utils.go#L692 func escapeStringBackslash(buf []byte, v string) []byte { \tpos := len(buf) \tbuf = reserveBuffer(buf, len(v)*2)  \tfor i := 0; i \u0026lt; len(v); i++ { \tc := v[i] \tswitch c { \tcase \u0026#39;\\x00\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;0\u0026#39; \tpos += 2 \tcase \u0026#39;\\n\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;n\u0026#39; \tpos += 2 \tcase \u0026#39;\\r\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;r\u0026#39; \tpos += 2 \tcase \u0026#39;\\x1a\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;Z\u0026#39; \tpos += 2 \tcase \u0026#39;\\\u0026#39;\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;\\\u0026#39;\u0026#39; \tpos += 2 \tcase \u0026#39;\u0026#34;\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;\u0026#34;\u0026#39; \tpos += 2 \tcase \u0026#39;\\\\\u0026#39;: \tbuf[pos] = \u0026#39;\\\\\u0026#39; \tbuf[pos+1] = \u0026#39;\\\\\u0026#39; \tpos += 2 \tdefault: \tbuf[pos] = c \tpos++ \t} \t}  \treturn buf[:pos] } æ‰€ä»¥ä½¿ç”¨ æ’å€¼æ¨¡å¼ è§„é¿å¤§å¤šæ•° SQL æ³¨å…¥ï¼Œç¦æ­¢ä½¿ç”¨ä¼ å…¥çš„å‚æ•°æ¥æ‹¼æ¥ SQL è¯­å¥ã€‚\nå¦‚æœä½ ä½¿ç”¨ gorm è¯·æ³¨æ„ https://gorm.io/zh_CN/docs/security.html åˆ—å‡ºçš„å‡½æ•°ï¼Œä½¿ç”¨æ’å€¼æ¨¡å¼æˆ–è€…æ£€æµ‹è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„å‚æ•°ã€‚\nXSS æ¨èé˜…è¯»è¿™ç‰‡æ–‡ç«  https://tech.meituan.com/2018/09/27/fe-security.html\nä» golang åç«¯çš„è§’åº¦æ¥è¯´ï¼Œæ¸…æ¥šçŸ¥é“æ•°æ®æœ€åè½åœ¨å‰ç«¯ä½ç½®å¹¶åšå¥½ç›¸å¯¹åº”è½¬ä¹‰è§„åˆ™ã€‚\nCSRF æ¨èé˜…è¯»è¿™ç‰‡æ–‡ç«  https://tech.meituan.com/2018/10/11/fe-security-csrf.html\nç›®å½•éå† gin package main  import ( \t\u0026#34;log\u0026#34;  \t\u0026#34;github.com/gin-gonic/gin\u0026#34; )  func main() { \tr := gin.Default() \tr.Static(\u0026#34;/uploads\u0026#34;, \u0026#34;./uploads\u0026#34;) \tif err := r.Run(\u0026#34;:8080\u0026#34;); err != nil { \tlog.Printf(\u0026#34;[Main] Gin engine error: %v\u0026#34;, err) \t} } æ¢ç©¶ä¸‹æ˜¯å¦å­˜åœ¨ç›®å½•éå†ï¼Œç¿»é˜…ä»£ç  static æœ€åå¤„ç†çš„æ˜¯è·¯ç”± /uploads/*filepathï¼Œè·å–æ–‡ä»¶å file := c.Param(\u0026quot;filepath\u0026quot;) å¹¶æ‰“å¼€è·å–æ–‡ä»¶å†…å®¹ f, err := fs.Open(file)\nè´´ä¸‹ä»£ç ï¼š\nr.StaticFS(\u0026#34;/uploads\u0026#34;, Dir(\u0026#34;./uploads\u0026#34;, false))  func (group *RouterGroup) StaticFS(relativePath string, fs http.FileSystem) IRoutes { \t... \thandler := group.createStaticHandler(relativePath, fs) \t// è·¯ç”±è§„åˆ™ \turlPattern := path.Join(relativePath, \u0026#34;/*filepath\u0026#34;)  ... \tgroup.GET(urlPattern, handler) \tgroup.HEAD(urlPattern, handler)  ... } // createStaticHandler ç”Ÿæˆé™æ€æ–‡ä»¶å¤„ç†è·¯ç”± func (group *RouterGroup) createStaticHandler(relativePath string, fs http.FileSystem) HandlerFunc { \tabsolutePath := group.calculateAbsolutePath(relativePath) \tfileServer := http.StripPrefix(absolutePath, http.FileServer(fs)) \treturn func(c *Context) { \t... \tfile := c.Param(\u0026#34;filepath\u0026#34;)// è·å–æ–‡ä»¶å \t// Check if file exists and/or if we have permission to access it \tf, err := fs.Open(file) // æ‰“å¼€æ–‡ä»¶ \t... \tf.Close()  \tfileServer.ServeHTTP(c.Writer, c.Request) \t} } package http  type Dir string func (d Dir) Open(name string) (File, error) { \t... \tdir := string(d) \tif dir == \u0026#34;\u0026#34; { \tdir = \u0026#34;.\u0026#34; \t} \tfullName := filepath.Join(dir, filepath.FromSlash(path.Clean(\u0026#34;/\u0026#34;+name))) // `Clean()` æ–¹æ³•çœ‹ï¼š https://golang.org/pkg/path/#Cleanã€‚ \tf, err := os.Open(fullName) \t... \treturn f, nil } åœ¨çœ‹çœ‹æœ€åå¦‚ä½•æ‰“å¼€æ–‡ä»¶çš„ fullName := filepath.Join(dir, filepath.FromSlash(path.Clean(\u0026quot;/\u0026quot;+name))) ä¸­çš„ path.Clean(\u0026quot;/\u0026quot;+name) name å‰çš„ / å­—ç¬¦å¾ˆå…³é”®ï¼Œè®©ä¸€åˆ‡æ²¡æœ‰å¸Œæœ›ã€‚ã€‚ã€‚\næƒ³è¦å®ç°é™æ€æ–‡ä»¶æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ golang http.Dir å¤„ç†ä¼ å…¥æ–‡ä»¶å‚æ•°ï¼Œé¿å…ç›®å½•éå†ã€‚\nå‘½ä»¤æ‰§è¡Œ ä»£ç æ‰§è¡Œ JsonpåŠ«æŒ Jsonp(JSON with Padding)æ˜¯JSONçš„ä¸€ç§\u0026quot;ä½¿ç”¨æ¨¡å¼\u0026quot;ï¼Œå¯ä»¥è®©ç½‘é¡µä»åˆ«çš„åŸŸåï¼ˆç½‘ç«™ï¼‰é‚£è·å–èµ„æ–™ï¼Œå³è·¨åŸŸè¯»å–æ•°æ®ã€‚è®¾è®¡å‡ºæ¥å°±æ˜¯ä¸ºäº†è§£å†³åŒæºç­–ç•¥çš„é™åˆ¶ã€‚\nå†™ä¸ªç®€å• jsonp demoï¼š\nserver ä»£ç ï¼š\npackage main import ( \t\u0026#34;net/http\u0026#34; \t\u0026#34;github.com/gin-gonic/gin\u0026#34; ) func main() { \tr := gin.Default() \tr.GET(\u0026#34;/jsonp\u0026#34;, func(c *gin.Context) { \tdata := map[string]interface{}{ \t\u0026#34;name\u0026#34;: \u0026#34;bar\u0026#34;, \t\u0026#34;desc\u0026#34;: \u0026#34;desc..\u0026#34;, \t} \tc.JSONP(http.StatusOK, data) \t}) \tr.Run(\u0026#34;:8080\u0026#34;) } client ä»£ç ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt;  \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \t\u0026lt;script src=\u0026#34;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt;  \u0026lt;title\u0026gt;Jsonp Test\u0026lt;/title\u0026gt;  \u0026lt;script\u0026gt;  log = function (data) {  alert(data.name);  console.log(data.desc);  };  \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \t\u0026lt;!-- script --\u0026gt;  \u0026lt;script src=\u0026#34;http://localhost:8080/jsonp?callback=log\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \t\u0026lt;!-- jquery --\u0026gt; \t\u0026lt;script\u0026gt;  $(document).ready(function () {  $.ajax({  type: \u0026#34;get\u0026#34;,  url: \u0026#34;http://localhost:8080/jsonp\u0026#34;,  dataType: \u0026#34;jsonp\u0026#34;,  jsonp: \u0026#34;callback\u0026#34;,//ä¼ é€’ç»™è¯·æ±‚å¤„ç†ç¨‹åºæˆ–é¡µé¢çš„ï¼Œç”¨ä»¥è·å¾—jsonpå›è°ƒå‡½æ•°åçš„å‚æ•°å(ä¸€èˆ¬é»˜è®¤ä¸º:callback)  jsonpCallback: \u0026#34;log\u0026#34;,//è‡ªå®šä¹‰çš„jsonpå›è°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°åï¼Œä¹Ÿå¯ä»¥å†™\u0026#34;?\u0026#34;ï¼ŒjQueryä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†æ•°æ®  success: function (data) {},  error: function () {alert(\u0026#39;fail\u0026#39;);}  });  });  \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¦‚ä½•è‡ªåŠ¨åŒ–æ£€æµ‹ï¼Ÿ a-tour-of-xrayè¿™ç¯‡åšå®¢ä¸­å·²ç»è¯¦ç»†ä»‹ç»äº†å¦‚ä½•æ‰‹å·¥æŒ–æ˜\nåœ¨â€œåˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯â€çš„éƒ¨åˆ†ä¹Ÿä¸æ˜¯é‡‡å–ç®€å•æ­£åˆ™åŒ¹é…å‘ç°æ•æ„Ÿä¿¡æ¯è€Œæ˜¯é‡‡ç”¨ASTè¯­ä¹‰åˆ†æã€‚æˆ‘åœ¨æ­¤ jweny - check_jsonp_based_on_ast åŸºç¡€åšäº†æ·±åº¦ä¼˜åŒ–ï¼ŒçœŸæ­£çš„èƒ½æ£€æµ‹ç±»ä¼¼å¦‚ä¸‹jsè¯­å¥ï¼š\ncallback({\u0026#34;data\u0026#34;: {username:\u0026#34;jweny\u0026#34;}}); callback({\u0026#34;data\u0026#34;: {a:\u0026#34;jweny\u0026#34;,test:0, args:[\u0026#34;123\u0026#34;, 1,{username:\u0026#34;xx\u0026#34;}]}}); callback([{\u0026#34;info\u0026#34;: {\u0026#34;username\u0026#34;: \u0026#34;jweny\u0026#34;}}]) cb(\u0026#39; {\u0026#34;username\u0026#34;:\u0026#34;jweny\u0026#34;} \u0026#39;) /*aa*/ window.cb({\u0026#34;username\u0026#34;:\u0026#34;jweny\u0026#34;}) /*aa*/ window.cb \u0026amp;\u0026amp; window.cb({\u0026#34;username\u0026#34;:\u0026#34;jweny\u0026#34;}) /*aa*/ cb \u0026amp;\u0026amp; cb({\u0026#34;username\u0026#34;:\u0026#34;jweny\u0026#34;}) a={\u0026#34;username\u0026#34;: \u0026#34;jweny\u0026#34;}; cb({\u0026#34;s\u0026#34;: a}); a={\u0026#34;username\u0026#34;: \u0026#34;jweny\u0026#34;}; cb(a); ç›¸å…³æºç è´´åœ¨æ­¤ï¼šhttps://github.com/Buzz2d0/taser/blob/main/probe/jsonp.go\n","permalink":"https://zznq.imipy.com/posts/golang-web-audit/","title":"golang web audit å°è®°"},{"content":"æˆ‘å°è¯•ç”¨ golang ç¼–å†™ä¸€äº›æ ¸å¿ƒä»£ç ï¼Œå†åˆ©ç”¨ cgo çš„ç‰¹æ€§å°†å…¶æ‰“åŒ…æˆ dylib æ–‡ä»¶ï¼Œä»¥ä¾¿äºæˆ‘åœ¨objc ä¸­è°ƒç”¨ï¼ˆå› ä¸ºæˆ‘ objc å†™çš„å¾ˆçƒ‚ï¼‰ã€‚\nå…ˆå†™ä¸ªå¾ˆç®€å•çš„ cgo ç¨‹åº main.go ï¼š\npackage main  //void HelloWorld(); import \u0026#34;C\u0026#34; import \u0026#34;fmt\u0026#34;  //export HelloWorld func HelloWorld() { \tfmt.Println(\u0026#34;Hello World!!!\u0026#34;) }  func main() {} ä»£ç ä¸­æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸‹ï¼š\n import \u0026quot;C\u0026quot; è¯­å¥åˆ™è¡¨ç¤ºå¼€å¯äº†CGOç‰¹æ€§ //export HelloWorld CGO æŒ‡ä»¤å°†å…¶å¯¼å‡ºä¸ºCè¯­è¨€å‡½æ•°  ç¼–è¯‘ä¸ºdylibåŠ¨æ€åº“ï¼š $ go build -buildmode=c-shared--ldflags=\u0026quot;-w -s\u0026quot; -o cgodemo.dylib cgoDemo/main.go\næŸ¥çœ‹ä¸‹æ–‡ä»¶ä¿¡æ¯ï¼š\n$ file cgodemo.dylib cgodemo.dylib: Mach-O 64-bit dynamically linked shared library x86_64 $ otool -L cgodemo.dylib cgodemo.dylib:  cgodemo.dylib (compatibility version 0.0.0, current version 0.0.0)  /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1292.100.5) è°ƒç”¨ä¸‹åŠ¨æ€åº“æµ‹è¯•ä¸‹ main.c ï¼š\n#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;dlfcn.h\u0026gt; int main() {  char *so_path = \u0026#34;./cgodemo.dylib\u0026#34;;  void *lib = dlopen(so_path, RTLD_LAZY);  void (*HelloWorld)();  HelloWorld = dlsym(lib, \u0026#34;HelloWorld\u0026#34;);  HelloWorld(); } æµ‹è¯•ï¼š\n$ clang main.c -o main $ ./main Hello World!!! amazing!\n åœ¨ objc ä¸‹å°è¯•åŠ è½½åŠ¨æ€åº“ï¼š\n#import \u0026lt;Foundation/Foundation.h\u0026gt; #include \u0026#34;dlfcn.h\u0026#34; int main(int argc, const char * argv[]) {  @autoreleasepool {  void *lib = dlopen(\u0026#34;../cgodemo.dylib\u0026#34;, RTLD_LAZY);  if (NULL != lib){  NSLog(@\u0026#34;not found dylib file...\u0026#34;);  return 1;  }  void (*HelloWorld)(void) = dlsym(lib, \u0026#34;HelloWorld\u0026#34;);  if (NULL != lib){  HelloWorld();  }else{  NSLog(@\u0026#34;not found HelloWorld()\u0026#34;);  }  dlclose(lib);  }  return 0; } ç„¶è€Œå¹¶éä¸€ç•ªé£é¡ºï¼Œæ‰“å° not found HelloWorld()ï¼Œæ‰¾ä¸åˆ° HelloWorld å‡½æ•°ï¼Œgoogle äº†å¥½ä¹…ä¹Ÿæ²¡æ’æŸ¥å‡ºåŸå› ï¼Œè·¯è¿‡çš„æ‚¨å¦‚æœçŸ¥é“å’‹è§£å†³éº»çƒ¦ğŸ™å‘Šè¯‰æˆ‘ä¸€ä¸‹ğŸ˜ã€‚\n æ”¾å¼ƒï¼Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½\næ’æŸ¥é—®é¢˜æ—¶å‘ç°äº† mobile å·¥å…·ï¼šhttps://github.com/golang/mobile ï¼Œå¯ä»¥åœ¨ Java \u0026amp; Objc ä¸­è°ƒç”¨ golang, ç›¸å…³æ–‡æ¡£åœ¨ https://github.com/golang/go/wiki/Mobile ã€‚\nè™½ç„¶è¯´äº† gobuild å¹¶ä¸æ”¯æŒå•ç‹¬ä½¿ç”¨ï¼Œä½†æ˜¯ $ gomobile bind -target=ios golang.org/x/mobile/example/bind/hello å¯ä»¥å°† hello package ç”Ÿæˆ Hello.framework, ç„¶åå°±å¯ä»¥åœ¨ objc ä¸­ç›´æ¥è°ƒç”¨äº† ğŸ‚ğŸº\næ‰€ä»¥é¦–å…ˆè§£å†³ä¸‹å¦‚ä½•ä¿®æ”¹å‚æ•°è®©å…¶å¯ä»¥ç¼–è¯‘ä¸º macos å¹³å°çš„ Frameworkï¼Œgoogle åˆ°ä¸€ä¸ª https://github.com/golang/go/issues/31258 ï¼Œä»–æ˜¯è¿™ä¹ˆè§£å†³çš„ï¼š\n// cmd/gomobile/env.go ... case \u0026#34;386\u0026#34;, \u0026#34;amd64\u0026#34;: \tclang, cflags, err = envClang(\u0026#34;iphonesimulator\u0026#34;) \tcflags += \u0026#34; -mios-simulator-version-min=\u0026#34; + buildIOSVersion // ä¿®è¯¥ä¸ºï¼š \tclang, cflags, err = envClang(\u0026#34;macosx\u0026#34;) \tcflags += \u0026#34; -mmacosx-version-min=10.11\u0026#34; ... æˆ‘ fork ä¸‹æ¥ä¿®æ”¹å¹¶æäº¤äº† https://github.com/Buzz2d0/mobile ï¼Œåœ¨æµ‹è¯•å‘ç°è¿™é‡Œç‰ˆæœ¬-mmacosx-version-min=10.11 å¯ä»¥æ ¹æ®è‡ªå·±ç³»ç»Ÿç‰ˆæœ¬æ¥å†³å®šï¼Œæˆ‘ç”¨çš„ bigsur 11.3 å°±æ”¹ä¸ºäº† 10.15 ã€‚\n å®‰è£…ä¿®æ”¹åçš„ gomobile\n$ git clone https://github.com/Buzz2d0/mobile $ cd mobile $ go build golang.org/x/mobile/cmd/gomobile $ gomobile init æ•²ä¸ªæµ‹è¯•ä»£ç  lib/lib.goï¼š\npackage lib  import \u0026#34;fmt\u0026#34;  func Greetings(name string) string { \treturn fmt.Sprintf(\u0026#34;Hello, %s!\u0026#34;, name) } åˆ›å»º Lib.framework ï¼š $ ../mobile/gomobile bind -target=ios demo/lib\næŠŠ Lib.framework å¯¼å…¥åˆ° Xcode ä¸­ï¼Œå…·ä½“æ“ä½œï¼šhttps://github.com/golang/go/wiki/Mobile#building-and-deploying-to-ios-1\nmain.m :\n#import \u0026lt;Foundation/Foundation.h\u0026gt; #import \u0026lt;objc/runtime.h\u0026gt; #import \u0026#34;Lib/Lib.h\u0026#34;  int main(int argc, const char * argv[]) {  @autoreleasepool {  NSString * str = LibGreetings(@\u0026#34;this is a golang function\u0026#34;);  NSLog(@\u0026#34;%@\u0026#34;, str);  }  return 0; } ç¼–è¯‘è¿è¡Œ æˆåŠŸå•¦ï¼\n","permalink":"https://zznq.imipy.com/posts/cgoobjc/","title":"cgo \u0026 objc"},{"content":"ä¹‹å‰çœ‹åˆ° Xray - å¦‚ä½•ç¼–å†™expressionè¡¨è¾¾å¼ æåˆ°è¿™ä¸ªåº“ https://github.com/google/cel-spec\næ­£å¥½å·¥ä½œæ–¹é¢ä¹Ÿé‡åˆ°è¿™ä¸ªéœ€æ±‚äº†ï¼Œå°±æ¥ç®€å•çš„ç ”ç©¶ä¸‹ï¼Œå…ˆçœ‹ä¸‹ç›¸å…³èµ„æ–™ï¼š\n cel-spec ä»‹ç» cel-go github cel-go å…¥é—¨æ–‡æ¡£   cel æ˜¯å»ºç«‹ protocol ä¹‹ä¸Šçš„ã€‚\nåœ¨ demo é¡¹ç›®ä¸‹åˆ›å»º fprint åŒ…ï¼›å¹¶åœ¨å…¶ç›®å½•ä¸‹åˆ›å»º fprint.proto æ–‡ä»¶\nsyntax = \u0026#34;proto3\u0026#34;;package fprint; // https://developers.google.com/protocol-buffers/docs/proto3#packages option go_package = \u0026#34;fprint/bp\u0026#34;; // golang package åŒ…å message Response { string url = 1; int32 status = 2 ; map\u0026lt;string, string\u0026gt; headers = 3; string content_type = 4; string title = 5; bytes body = 6; string md5 = 7;}ä½¿ç”¨ $ protoc --go_out=./ fprint/fprint.proto ç”Ÿæˆ go ä»£ç \nåˆ›å»º cel.go æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹è‡ªå·±å®šä¹‰å‡½æ•°ç­‰ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\ndemo â”œâ”€â”€ fprint â”‚ â”œâ”€â”€ bp â”‚ â”‚ â””â”€â”€ fprint.pb.go â”‚ â”œâ”€â”€ cel.go â”‚ â”œâ”€â”€ cel_test.go â”‚ â””â”€â”€ fprint.proto cel.go:\npackage fprint  import ( \t\u0026#34;bytes\u0026#34; \t\u0026#34;log\u0026#34; \t\u0026#34;regexp\u0026#34;  \t\u0026#34;github.com/google/cel-go/cel\u0026#34; \t\u0026#34;github.com/google/cel-go/checker/decls\u0026#34; \t\u0026#34;github.com/google/cel-go/common/types\u0026#34; \t\u0026#34;github.com/google/cel-go/common/types/ref\u0026#34; \t\u0026#34;github.com/google/cel-go/interpreter/functions\u0026#34;  \t\u0026#34;demo/fprint/bp\u0026#34;  \texprpb \u0026#34;google.golang.org/genproto/googleapis/api/expr/v1alpha1\u0026#34; )  func NewEnv(f *fprintLib) (*cel.Env, error) { \treturn cel.NewEnv(cel.Lib(f)) }  func Evaluate(env *cel.Env, expression string, params map[string]interface{}) (ref.Val, error) { \tast, iss := env.Compile(expression) \tif iss.Err() != nil { \tlog.Println(\u0026#34;compile error\u0026#34;) \treturn nil, iss.Err() \t}  \tprg, err := env.Program(ast) \tif err != nil { \tlog.Println(\u0026#34;Program creation error\u0026#34;) \treturn nil, err \t}  \tout, _, err := prg.Eval(params) \tif err != nil { \tlog.Println(\u0026#34;Evaluation error\u0026#34;) \treturn nil, err \t} \treturn out, nil }  type fprintLib struct { \tenvOptions []cel.EnvOption \tprogramOptions []cel.ProgramOption }  func NewEnvOption() *fprintLib { \tf := \u0026amp;fprintLib{} \tf.envOptions = []cel.EnvOption{  // æ³¨å†Œ response ç±»å‹ \tcel.Container(\u0026#34;fprint.Response\u0026#34;), \tcel.Types( \t\u0026amp;bp.Response{}, \t), \tcel.Declarations( \tdecls.NewIdent(\u0026#34;response\u0026#34;, decls.NewObjectType(\u0026#34;fprint.Response\u0026#34;), nil), \t),  // å®šä¹‰æ–¹æ³•ã€å‡½æ•°ç­‰ \tcel.Declarations( \tdecls.NewFunction(\u0026#34;bcontains\u0026#34;, \tdecls.NewInstanceOverload(\u0026#34;bytes_bcontains_bytes\u0026#34;, \t[]*exprpb.Type{decls.Bytes, decls.Bytes}, \tdecls.Bool)), \tdecls.NewFunction(\u0026#34;regexp\u0026#34;, \tdecls.NewOverload(\u0026#34;regexp_string_string\u0026#34;, \t[]*exprpb.Type{decls.String, decls.String}, \tdecls.Bool)), \tdecls.NewFunction(\u0026#34;version\u0026#34;, \tdecls.NewOverload(\u0026#34;version_string_string_int\u0026#34;, \t[]*exprpb.Type{decls.String, decls.String, decls.Int}, \tdecls.String)), \t), \t} \tf.programOptions = []cel.ProgramOption{  cel.Functions(  // bytes_bcontains_bytes çš„å®ç° \t\u0026amp;functions.Overload{ \tOperator: \u0026#34;bytes_bcontains_bytes\u0026#34;, \tBinary: func(lhs ref.Val, rhs ref.Val) ref.Val { \tv1, ok := lhs.(types.Bytes) \tif !ok { \treturn types.ValOrErr(lhs, \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to bcontains\u0026#34;, lhs.Type()) \t} \tv2, ok := rhs.(types.Bytes) \tif !ok { \treturn types.ValOrErr(rhs, \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to bcontains\u0026#34;, rhs.Type()) \t} \treturn types.Bool(bytes.Contains(v1, v2)) \t}, \t},  // regexp_string_string çš„å®ç° \t\u0026amp;functions.Overload{ \tOperator: \u0026#34;regexp_string_string\u0026#34;, \tBinary: func(arg1, arg2 ref.Val) ref.Val { \treg, ok := arg1.(types.String) \tif !ok { \treturn types.ValOrErr(arg1, \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to regexp\u0026#34;, arg1.Type()) \t} \tval, ok := arg2.(types.String) \tif !ok { \treturn types.ValOrErr(arg2, \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to regexp\u0026#34;, arg2.Type()) \t} \tmatched, err := regexp.MatchString(string(reg), string(val)) \tif err != nil { \treturn types.ValOrErr(arg2, \u0026#34;Wrong regular syntax \u0026#39;%v\u0026#39; passed to version\u0026#34;, arg2.Type()) \t} \treturn types.Bool(matched) \t}, \t},  // version_string_string_int çš„å®ç° \t\u0026amp;functions.Overload{ \tOperator: \u0026#34;version_string_string_int\u0026#34;, \tFunction: func(values ...ref.Val) ref.Val { \tif len(values) != 3 { \treturn types.NewErr(\u0026#34;too many arguments to \u0026#39;substr\u0026#39;\u0026#34;) \t} \toffset, ok := values[2].(types.Int) \tif !ok { \treturn types.ValOrErr(values[2], \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to version\u0026#34;, values[2].Type()) \t} \tif offset \u0026lt; 0 { \toffset = 0 \t}  \treg, ok := values[0].(types.String) \tif !ok { \treturn types.ValOrErr(values[0], \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to version\u0026#34;, values[0].Type()) \t} \tval, ok := values[1].(types.String) \tif !ok { \treturn types.ValOrErr(values[1], \u0026#34;unexpected type \u0026#39;%v\u0026#39; passed to version\u0026#34;, values[1].Type()) \t} \tregx, err := regexp.Compile(string(reg)) \tif err != nil { \treturn types.ValOrErr(values[0], \u0026#34;Wrong regular syntax \u0026#39;%v\u0026#39; passed to version\u0026#34;, values[0].Type()) \t} \tvals := regx.FindStringSubmatch(string(val)) \tif len(vals) \u0026lt;= 0 { \treturn types.String(\u0026#34;\u0026#34;) \t} \toffset += 1 \tif int(offset) \u0026gt; len(vals) { \toffset = types.Int(len(vals) - 1) \t} \treturn types.String(vals[offset]) \t}, \t}, \t), \t} \treturn f }  // EnvOptions returns options for the standard CEL function declarations and macros. func (f *fprintLib) CompileOptions() []cel.EnvOption { \treturn f.envOptions }  // ProgramOptions returns function implementations for the standard CEL functions. func (f *fprintLib) ProgramOptions() []cel.ProgramOption { \treturn f.programOptions } å†™ä¸ªå•å…ƒæµ‹è¯•è¿è¡Œä¸‹ï¼Œcel_test.go ï¼š\npackage fprint  import ( \t\u0026#34;demo/fprint/bp\u0026#34; \t\u0026#34;testing\u0026#34; )  func TestFprint(t *testing.T) { \tflib := NewEnvOption() \tenv, err := NewEnv(flib) \tif err != nil { \tt.Fatal(err) \t} \tparams := map[string]interface{}{} \tparams[\u0026#34;response\u0026#34;] = \u0026amp;bp.Response{ \tUrl: \u0026#34;http://www.baidu.com\u0026#34;, \tStatus: 404, \tHeaders: map[string]string{ \t\u0026#34;server\u0026#34;: \u0026#34;nginx\u0026#34;, \t}, \tContentType: \u0026#34;application/json\u0026#34;, \tTitle: \u0026#34;this is a titleTest Bootstrap v0.1.1 test\u0026#34;, \tBody: []byte(\u0026#34;http.body\u0026#34;), \t}  \tout, err := Evaluate(env, `response.status == 200`, params) \tif err != nil { \tt.Fatal(err) \t} \tt.Log(\u0026#34;response.status == 200\u0026#34;, out)  \tout, err = Evaluate(env, `response.headers[\u0026#34;server\u0026#34;] == \u0026#34;nginx\u0026#34;`, params) \tif err != nil { \tt.Fatal(err) \t} \tt.Log(`response.headers[\u0026#34;server\u0026#34;] == \u0026#34;nginx\u0026#34;`, out)  \tout, err = Evaluate(env, `response.body.bcontains(b\u0026#34;body\u0026#34;)`, params) \tif err != nil { \tt.Fatal(err) \t} \tt.Log(`response.body.bcontains(b\u0026#34;body\u0026#34;)`, out)  \tout, err = Evaluate(env, `regexp(\u0026#34;(?im)bootstrap ([vV])?([0-9\\\\.]+)\u0026#34;, response.title)`, params) \tif err != nil { \tt.Fatal(err) \t} \tt.Log(`regexp(\u0026#34;(?im)bootstrap ([vV])?([0-9\\\\.]+)\u0026#34;, response.title)`, out)  \tout, err = Evaluate(env, `version(\u0026#34;(?im)bootstrap ([vV])?([0-9\\\\.]+)\u0026#34;, response.title, 1)`, params) \tif err != nil { \tt.Fatal(err) \t} \tt.Log(`version(\u0026#34;(?im)bootstrap ([vV])?([0-9\\\\.]+)\u0026#34;, response.title, 1)`, out) } ","permalink":"https://zznq.imipy.com/posts/cel-go-demo/","title":"cel-go åˆæ¢"},{"content":"æŸ¥çœ‹åŒ…å†…å®¹ï¼Œåœ¨Resources ç›®å½•ä¸‹æ‰¾åˆ° app.asar æ–‡ä»¶\nè§£å‹ app.asar æ–‡ä»¶\n$ npm install asar -g $ cd /Applications/AppName.app/Contents/Resources $ asar e app.asar appCore è¿›å…¥åˆ°ä¸app.asar.unpackedçš„åŒçº§ç›®å½•ä¸‹ï¼Œä¸ç„¶ä¼šæœ‰å¦‚ä¸‹é”™è¯¯ï¼šhttps://github.com/electron/asar/issues/37\n è§£åŒ…ä¹‹åç›®å½•å¦‚ä¸‹\nls -lahrt total 8 drwxr-xr-x@ 64 staff 2.0K May 4 11:09 .. -rw-r--r-- 1 staff 984B May 4 11:09 package.json drwxr-xr-x 3 staff 96B May 4 11:09 dist drwxr-xr-x 5 staff 160B May 4 11:09 . drwxr-xr-x 166 staff 5.2K May 4 11:09 node_modules æºç åœ¨ dist/electron ä¸‹ï¼›ä¸€èˆ¬è¿™é‡Œçš„ js éƒ½æ˜¯ç»è¿‡æ··æ·†ï¼Œé€»è¾‘éœ€è¦è¿›è¡Œå…·ä½“çš„åˆ†æ\u0026hellip;\nJSåæ··æ·†è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ç¹ççš„ï¼Œç°åœ¨èƒ½åŠ›æœ‰é™ï¼Œç­‰ä¹‹åé‡åˆ°å®é™…çš„éœ€æ±‚æ—¶åœ¨ç ”ç©¶ä¸‹å§ï¼\n æ‹–åˆ°chromeé‡Œé¢è¿›è¡Œæ ¼å¼åŒ– åæ··æ·† js ä»£ç  ä½¿ç”¨ä¸€äº›è„šæœ¬ https://gist.github.com/Buzz2d0/776f8d1bb65732504775dd204ff9b303 AST  å‚è€ƒæ–‡ç«   ä½¿ç”¨ estools è¾…åŠ©åæ··æ·† Javascript  ","permalink":"https://zznq.imipy.com/posts/macos-electron-analysis/","title":"MacOS - Electron åº”ç”¨åˆ†æå°è®°"},{"content":"MacOS ä¸‹çš„ app ä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è€Œæ˜¯ä¸€ä¸ª Application Bundleï¼Œè€Œ Bundle å°±æ˜¯ä¸€ä¸ªéµå¾ªç‰¹å®šç»“æ„çš„ç›®å½•ï¼ŒåŒ…å« Info.plistã€å¯æ‰§è¡Œæ–‡ä»¶ã€èµ„æºã€Framworks ç­‰å†…å®¹ï¼Œå…¶ä¸­ Info.plist å’Œ Executable æ˜¯å¿…è¦çš„ã€‚\næ¥çœ‹ä¸‹ WeChat.app Bundle çš„ç›®å½•ç»“æ„ï¼Œå…ˆå¿½ç•¥ Framworksã€Resources ç­‰ï¼š\nWeChat.app â”œâ”€â”€ Contents â”‚ â””â”€â”€ MacOS â”‚ â””â”€â”€ WeChat â”‚ â””â”€â”€ Info.plist äº†è§£å…³é”®æ–‡ä»¶ä¿¡æ¯ - çŸ¥å½¼çŸ¥å·± Info.plist æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£å…³äºInfo.plist çš„ä»‹ç»ä¸­ï¼Œæœ‰ä¸€å¥å¾ˆå…³é”®è¯ï¼š\n The way an app provides its metadata to the system is through the use of a special file called an information property list file, or Info.plist for short.\n ä½¿ç”¨ plutil æŸ¥çœ‹ Info.plist å†…å®¹\n$ plutil -p Info.plist\nè¿˜å¯ä»¥å°†å…¶è½¬æ¢ä¸º xml1 binary1 json swift objc\n$ plutil -convert json Info.plist -o Info-plist.json\n ** MacOS æ”¯æŒä¸‰ç§å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼**\n è§£é‡Šå™¨è„šæœ¬æ ¼å¼ï¼Œè¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†ï¼Œç±»ä¼¼ ruby perl python ç­‰ã€‚ Mach-O (Mach Object çš„ç¼©å†™)æ˜¯ IOS/MacOS ä¸‹çš„åŸç”Ÿå¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ é€šç”¨äºŒè¿›åˆ¶æ ¼å¼åˆç§°èƒ–äºŒè¿›åˆ¶æ ¼å¼ï¼ˆFat Binaryï¼‰ï¼Œæ˜¯å°†å¤šä¸ª Mach-O æ–‡ä»¶ç»„åˆæˆä¸€ä¸ªå¤šé‡æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚  é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ ä½¿ç”¨ file å‘½ä»¤æŸ¥çœ‹ä¿¡æ¯ï¼š\n$ file WeChat MacOS/WeChat: Mach-O 64-bit executable x86_64 è¿™é‡Œä»…æ”¯æŒ amd64ï¼Œæ‰¾ä¸ªé€šç”¨äºŒè¿›åˆ¶æ ¼å¼çš„ä¾‹å­ï¼š\n$ file /usr/bin/python /usr/bin/python: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64e:Mach-O 64-bit executable arm64e] /usr/bin/python (for architecture x86_64):\tMach-O 64-bit executable x86_64 /usr/bin/python (for architecture arm64e):\tMach-O 64-bit executable arm64 ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· lipo æ¥æ“ä½œé€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®ƒå¯ä»¥æ·»åŠ ã€æå–ã€åˆ é™¤ä»¥åŠæ›¿æ¢é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ç‰¹å®šæ¶æ„çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ã€‚ ç›´æ¥ç˜¦èº«ä¸ºæŸç§æ¶æ„çš„ç‰ˆæœ¬ï¼š $ lipo \u0026lt;Mach-O\u0026gt; -thin \u0026lt;æ¶æ„å\u0026gt; -output \u0026lt;è·¯å¾„\u0026gt; ä¹Ÿå¯ä»¥åˆå¹¶å¤šä¸ªæ¶æ„ï¼š $ lipo -create \u0026lt;Mach-O1\u0026gt; \u0026lt;Mach-O2\u0026gt; -output \u0026lt;è·¯å¾„\u0026gt;\né€šç”¨äºŒè¿›åˆ¶çš„â€œé€šç”¨â€ä¸æ­¢é’ˆå¯¹å¯ä»¥ç›´æ¥è¿è¡Œçš„å¯æ‰§è¡Œç¨‹åºï¼Œç³»ç»Ÿä¸­çš„åŠ¨æ€åº“dylibã€é™æ€åº“.aæ–‡ä»¶ä»¥åŠæ¡†æ¶ç­‰éƒ½å¯ä»¥æ˜¯é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯¹å®ƒä»¬ä¹Ÿå¯ä»¥åŒæ ·ä½¿ç”¨lipoå‘½ä»¤æ¥è¿›è¡Œç®¡ç†ã€‚ å¯ä»¥åœ¨\u0026lt;mach-o/fat.h\u0026gt;æ–‡ä»¶ä¸­æ‰¾åˆ°é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼çš„å£°æ˜(ğŸ“£: BigSur ä¸‹çš„SDKè¿ç§»åˆ°ï¼š/Library/Developer/CommandLineTools/SDKs/ ç›®å½•ä¸‹äº† )\nä½¿ç”¨ otool å·¥å…·æ‰“å°çš„ fat_header ä¿¡æ¯ï¼š\n$ otool -f -V /usr/bin/python Fat headers fat_magic FAT_MAGIC nfat_arch 2 architecture x86_64 cputype CPU_TYPE_X86_64 cpusubtype CPU_SUBTYPE_X86_64_ALL capabilities 0x0 offset 16384 size 55984 align 2^14 (16384) architecture arm64e cputype CPU_TYPE_ARM64 cpusubtype CPU_SUBTYPE_ARM64E capabilities PTR_AUTH_VERSION USERSPACE 0 offset 81920 size 39344 align 2^14 (16384) åœ¨ fat_arch ç»“æ„ä½“å¾€ä¸‹å°±æ˜¯å…·ä½“çš„Mach-Oæ–‡ä»¶æ ¼å¼äº†ã€‚\nMach-O æ–‡ä»¶ Mach-Oæ–‡ä»¶ç”±å¤´(Header)ã€è£…è½½æŒ‡ä»¤(Load commands)å’Œæ•°æ®(Data)ç»„æˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡MachOViewè½¯ä»¶è¿›è¡ŒæŸ¥çœ‹ã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†å°±æ˜¯Dataã€‚\n è¿™é‡Œç®€å•äº†è§£ä¸‹ Data: Dataå¯ä»¥åˆ†ä¸ºå¤šä¸ªæ®µ(Segment), æ¯ä¸ªæ®µåˆå¯ä»¥åˆ†ä¸ºå¤šä¸ªèŠ‚(Section)ã€‚\nsegmentå¯ä»¥ç†è§£ä¸ºä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ‹¥æœ‰å¯¹åº”çš„è¯»/å†™/æ‰§è¡Œæƒé™ã€‚ä»é€»è¾‘è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªæ®µå†…çš„èŠ‚å­˜å‚¨çš„æ•°æ®éƒ½æœ‰ç±»ä¼¼çš„ç›®çš„ã€‚å¦‚__TEXT æ®µå†…å­˜å‚¨çš„æœ‰æ±‡ç¼–æºä»£ç ã€å­—ç¬¦ä¸²ç­‰ï¼Œ__DATA æ®µå†…å­˜å‚¨éå¸¸é‡åˆå§‹åŒ–å˜é‡ç­‰ã€‚ä»å†…å­˜ç®¡ç†è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªæ®µçš„å¤§å°è¢«è¦æ±‚æ˜¯é¡µå¤§å°çš„å€æ•°ï¼Œä¹Ÿå°±æ˜¯ 4096B çš„å€æ•°ã€‚å½“ç¨‹åºåŠ è½½æ—¶ï¼Œå°±å¯ä»¥æ­£å¥½å°†ä¸€ä¸ªæ®µåŠ è½½åˆ°ä¸€ä¸ªé¡µå†…ã€‚\næ¯ä¸ªsegmentç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªsectionç»„æˆï¼Œsectionè¡¨ç¤ºç‰¹å®šå«ä¹‰æ•°æ®æˆ–è€…ä»£ç çš„é›†åˆ(ä¸éœ€è¦é¡µå¯¹é½)ã€‚åœ¨macOSä¸­ï¼Œé€šå¸¸çº¦å®šsegmentçš„åç§°ä¸ºåŒä¸‹åˆ’çº¿åŠ å…¨å¤§å†™å­—æ¯(å¦‚__TEXT)ï¼Œsectionçš„åç§°ä¸ºåŒä¸‹åˆ’çº¿åŠ å°å†™å­—æ¯(å¦‚__text)ã€‚\n header header ç»“æ„å®šä¹‰åœ¨ â€œmach-o/loader.hâ€ æ–‡ä»¶ä¸­ï¼Œé’ˆå¯¹32ä½ä¸64ä½æ¶æ„çš„cpuï¼Œåˆ†åˆ«ä½¿ç”¨äº†mach_headerä¸mach_header_64ç»“æ„ä½“æ¥æè¿°Mach-Oå¤´éƒ¨ã€‚\nstruct mach_header { \tuint32_t\tmagic;\t/* mach magic number identifier */ \tcpu_type_t\tcputype;\t/* cpu specifier */ \tcpu_subtype_t\tcpusubtype;\t/* machine specifier */ \tuint32_t\tfiletype;\t/* type of file */ \tuint32_t\tncmds;\t/* number of load commands */ \tuint32_t\tsizeofcmds;\t/* the size of all the load commands */ \tuint32_t\tflags;\t/* flags */ };  filetype å­—æ®µè¡¨ç¤º Mach-Oçš„å…·ä½“æ–‡ä»¶ç±»å‹ï¼Œæˆ‘è¿™é‡Œä¸»è¦å…³æ³¨ï¼šMH_EXECUTEã€MH_DYLIB ç±»å‹ã€‚ ncmds æŒ‡æ˜äº†Mach-Oæ–‡ä»¶ä¸­åŠ è½½å‘½ä»¤ï¼ˆload commandsï¼‰çš„æ•°é‡ã€‚  ä½¿ç”¨ $ otool -h -V æŸ¥çœ‹ header ä¿¡æ¯\n$ otool -h -V /usr/bin/python /usr/bin/python: Mach header magic cputype cpusubtype caps filetype ncmds sizeofcmds flags MH_MAGIC_64 X86_64 ALL 0x00 EXECUTE 18 1472 NOUNDEFS DYLDLINK TWOLEVEL PIE load command åœ¨mach_headerä¹‹åçš„æ˜¯Load CommandåŠ è½½å‘½ä»¤ï¼Œè¿™äº›åŠ è½½å‘½ä»¤åœ¨Mach-Oæ–‡ä»¶åŠ è½½è§£ææ—¶ï¼Œè¢«å†…æ ¸åŠ è½½å™¨æˆ–è€…åŠ¨æ€é“¾æ¥å™¨è°ƒç”¨ï¼ŒåŸºæœ¬çš„åŠ è½½å‘½ä»¤çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š\nstruct load_command { \tuint32_t cmd;\t/* type of load command */ \tuint32_t cmdsize;\t/* total size of command in bytes */ };  cmd å­—æ®µä»£è¡¨å½“å‰åŠ è½½å‘½ä»¤çš„ç±»å‹ cmdsize å­—æ®µä»£è¡¨å½“å‰åŠ è½½å‘½ä»¤çš„å¤§å°  åŠ è½½å‘½ä»¤ç±»å‹çš„å®šä¹‰åœ¨ mach-o/loader.h ä¸­ï¼Œä»¥ LC ä¸ºå‰ç¼€çš„ï¼›æ‰€æœ‰çš„è¿™äº›åŠ è½½å‘½ä»¤ç”±ç³»ç»Ÿå†…æ ¸åŠ è½½å™¨ç›´æ¥ä½¿ç”¨ï¼Œæˆ–ç”±åŠ¨æ€é“¾æ¥å™¨å¤„ç†ã€‚å…¶ä¸­å‡ ä¸ªå¸¸è§çš„åŠ è½½å‘½ä»¤æœ‰LC_SEGMENTã€LC_LOAD_DYLINKERã€LC_LOAD_DYLIBã€LC_MAINã€LC_CODE_SIGNATUREã€LC_ENCRYPTION_INFO ç­‰ã€‚\nè¿™é‡Œé‡ç‚¹å…³æ³¨ä¸‹ dylib çš„åŠ è½½ï¼Œå½“cmdç±»å‹æ—¶ LC_ID_DYLIBã€LC_LOAD_DYLIBã€LC_LOAD_WEAK_DYLIBä¸LC_REEXPORT_DYLIB æ—¶ï¼Œç»Ÿä¸€ä½¿ç”¨ dylib_command ç»“æ„ä½“è¡¨ç¤ºï¼š\nstruct dylib_command { \tuint32_t\tcmd;\t/* LC_ID_DYLIB, LC_LOAD_{,WEAK_}DYLIB, LC_REEXPORT_DYLIB */ \tuint32_t\tcmdsize;\t/* includes pathname string */ \tstruct dylib\tdylib;\t/* the library identification */ }; struct dylib {  union lc_str name;\t/* library\u0026#39;s path name */  uint32_t timestamp;\t/* library\u0026#39;s build time stamp */  uint32_t current_version;\t/* library\u0026#39;s current version number */  uint32_t compatibility_version;\t/* library\u0026#39;s compatibility vers number*/ }; çœ‹äº†è¿™ä¹ˆå¤šåŸç†æœ‰äº›æ™•ä¹ä¹ï¼Œå†™ä»£ç å®æ“ä¸€ä¸‹ã€‚\n ç”¨ Xcode åˆ›å»ºä¸€ä¸ª \u0026ldquo;InsertDemoApp\u0026rdquo; commandç¨‹åº\nmian.mm æ–‡ä»¶å†…å®¹:\n#import \u0026lt;Foundation/Foundation.h\u0026gt;  // Person @interface Person : NSObject @property (nonatomic) NSString *name; @property (nonatomic) NSNumber *age; - (NSString *)description; @end  @implementation Person - (NSString *)description {  return [NSString stringWithFormat:@\u0026#34;\u0026lt;%@: %@\u0026gt;\u0026#34;, self.name, self.age]; } @end   int main(int argc, const char * argv[]) {  @autoreleasepool {  NSLog(@\u0026#34;Hello, World!\u0026#34;);   Person *p = [[Person alloc] init];  [p setName:@\u0026#34;zznq\u0026#34;];  [p setAge:@10];   NSLog(@\u0026#34;person: %@\u0026#34;, p);  }  return 0; } å†ç”¨ Xcode åˆ›å»ºä¸€ä¸ª \u0026ldquo;InsertLibTest\u0026rdquo; dylibç¨‹åº main.mm æ–‡ä»¶å†…å®¹ï¼š\n#import \u0026lt;Foundation/Foundation.h\u0026gt; #import \u0026lt;objc/runtime.h\u0026gt;  @interface NSObject (Person) + (void) hookPerson; @end  @implementation NSObject (Person) // hook person description - (NSString *) personDescription {  NSLog(@\u0026#34;in personDescription\u0026#34;);  return [self personDescription]; } + (void) hookPerson {  NSLog(@\u0026#34;in hookPerson\u0026#34;);   Method originalMethod = class_getInstanceMethod(objc_getClass(\u0026#34;Person\u0026#34;), @selector(description));  Method swizzledMethod = class_getInstanceMethod([self class], @selector(personDescription));  if (originalMethod \u0026amp;\u0026amp; swizzledMethod){  method_exchangeImplementations(originalMethod, swizzledMethod);  } } @end  static void __attribute__((constructor)) initialize(void) {  NSLog(@\u0026#34;hook common inject success!\u0026#34;);   [NSObject hookPerson]; } ç¼–è¯‘ä¹‹åä½¿ç”¨ insert_dylib å°† libInsertLibTest.dylib æ³¨å…¥åˆ° InsertDemoApp\n$ insert_dylib libInsertLibTest.dylib InsertDemoApp $ ./InsertDemoApp_patched 2021-05-09 17:47:02.123 InsertDemoApp_patched[28336:319241] hook common inject success! 2021-05-09 17:47:02.123 InsertDemoApp_patched[28336:319241] in hookPerson 2021-05-09 17:47:02.123 InsertDemoApp_patched[28336:319241] Hello, World! 2021-05-09 17:47:02.123 InsertDemoApp_patched[28336:319241] in personDescription 2021-05-09 17:47:02.123 InsertDemoApp_patched[28336:319241] in personDescription 2021-05-09 17:47:02.123 InsertDemoApp_patched[28336:319241] person: \u0026lt;zznq: 10\u0026gt; å·²ç»æˆåŠŸåŠ è½½äº† libInsertLibTest.dylib æ–‡ä»¶ï¼Œhook æˆåŠŸã€‚\ninsert_dylib çš„åŸç†å°±æ˜¯åˆ©ç”¨ load_command åŠ è½½ dylibï¼›ç”¨ $ otool -l -V filename å¹¶ç”¨ diff å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶åä¸åŒå¤„ï¼š\n... --- \u0026lt; cmd LC_CODE_SIGNATURE \u0026lt; cmdsize 16 \u0026lt; dataoff 52432 \u0026lt; datasize 19168 --- \u0026gt; cmd LC_LOAD_DYLIB \u0026gt; cmdsize 48 \u0026gt; name libInsertLibTest.dylib (offset 24) \u0026gt; time stamp 0 Thu Jan 1 08:00:00 1970 \u0026gt; current version 0.0.0 \u0026gt; compatibility version 0.0.0 å¾ˆæ˜æ˜¾ç§»é™¤äº†ä»£ç ç­¾ååŠ è½½å‘½ä»¤ LC_CODE_SIGNATURE æ¢æˆäº†åŠ è½½ libInsertLibTest.dylib çš„å‘½ä»¤ã€‚\n å‚è€ƒæ–‡ç«   About Bundles Bundle Structures Mach-Oæ–‡ä»¶æ ¼å¼ - éè™« æ·±å…¥æµ…å‡ºMachO Mach-O æ–‡ä»¶æ ¼å¼æ¢ç´¢ dylibæµ…æ  ","permalink":"https://zznq.imipy.com/posts/macos-app-insert-dylib/","title":"MacOS App Insert dylib å°è®°"},{"content":"è¡¥å……ä¸‹åŸºç¡€çŸ¥è¯† åŠ¨æ€åŠ è½½ åŠ¨æ€åŠ è½½Dynamic Loadingï¼šæ˜¯ä¸€ç§ç¨‹åºè¿è¡Œæœºåˆ¶ï¼Œèƒ½è®©è®¡ç®—æœºç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ˆè€Œä¸æ˜¯ç¼–è¯‘æ—¶ï¼‰è£…è½½åº“ï¼ˆæˆ–è€…å…¶ä»–äºŒè¿›åˆ¶å¯¹è±¡ï¼‰åˆ°å†…å­˜ä¸­ï¼Œç„¶åæ£€ç´¢åº“ä¸­å‡½æ•°å’Œå˜é‡çš„åœ°å€ï¼Œå¹¶è¿è¡Œè¿™äº›å‡½æ•°æˆ–è®¿é—®è¿™äº›å˜é‡ï¼Œä¸”èƒ½åœ¨ä¸éœ€è¦æ—¶å°†åº“ä»å†…å­˜ä¸­å¸è½½ã€‚\nlinuxä¸‹çš„/procè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ Linux å†…æ ¸æä¾›äº†ä¸€ç§é€šè¿‡ /proc æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿è¡Œæ—¶è®¿é—®å†…æ ¸å†…éƒ¨æ•°æ®ç»“æ„ã€æ”¹å˜å†…æ ¸è®¾ç½®çš„æœºåˆ¶ã€‚procæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚å®ƒä»¥æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ä¸ºè®¿é—®ç³»ç»Ÿå†…æ ¸æ•°æ®çš„æ“ä½œæä¾›æ¥å£ã€‚\n /proc/\u0026lt;PID\u0026gt;/status / /proc/\u0026lt;PID\u0026gt;/statï¼š æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ /proc/\u0026lt;PID\u0026gt;/mapsï¼šè¿›ç¨‹å…³è”åˆ°çš„æ¯ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å’Œåº“æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ˜ å°„åŒºåŸŸåŠå…¶è®¿é—®æƒé™æ‰€ç»„æˆçš„åˆ—è¡¨ /proc/self/mapsï¼š å½“å‰è¿›ç¨‹çš„å†…å­˜æ˜ å°„å…³ç³»ï¼Œé€šè¿‡è¯»è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥å¾—åˆ°å†…å­˜ä»£ç æ®µåŸºå€ã€‚  ä»€ä¹ˆæ˜¯ Ptraceï¼Ÿ é€šè¿‡ä½¿ç”¨ ptraceï¼ˆåç§°æ˜¯ \u0026ldquo;process trace\u0026rdquo; çš„ç¼©å†™ï¼‰ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œä»è€Œä½¿æ§åˆ¶å™¨èƒ½å¤Ÿæ£€æŸ¥å’Œæ“çºµç›®æ ‡çš„å†…éƒ¨çŠ¶æ€ã€‚\nlinux ptrace å‡½æ•°æä¾›äº†è®¸å¤šæœ‰ç”¨çš„è°ƒè¯•æ“ä½œï¼š\n PTRACE_ATTACH å…è®¸ä¸€ä¸ªè¿›ç¨‹å°†è‡ªèº«é™„åŠ åˆ°å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œè°ƒè¯•ï¼Œä»è€Œæš‚åœè¿œç¨‹è¿›ç¨‹ã€‚ PTRACE_PEEKTEXT å…è®¸ä»å¦ä¸€ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´è¯»å–å†…å­˜ã€‚ PTRACE_POKETEXT å…è®¸å°†å†…å­˜å†™å…¥å¦ä¸€ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´ã€‚ PTRACE_GETREGS ä»è¿›ç¨‹ä¸­è¯»å–å½“å‰çš„å¤„ç†å™¨å¯„å­˜å™¨é›†ã€‚ PTRACE_SETREGS å†™å…¥è¿›ç¨‹çš„å½“å‰å¤„ç†å™¨å¯„å­˜å™¨é›†ã€‚ PTRACE_CONT æ¢å¤é™„åŠ è¿›ç¨‹çš„æ‰§è¡Œã€‚ PTRACE_DETACH æ˜¯é‡æ–°å¯åŠ¨æ“ä½œï¼›å®ƒè¦æ±‚ç›®æ ‡è¿›ç¨‹å¤„äº ptrace-stop ä¸­ã€‚  å‡½æ•°ç­¾åï¼š\nlong ptrace(enum __ptrace_request request, pid_t pid, void *addr, void *data); ğŸŒ° ï¼ˆLinux ubuntu 4.15.0-112-generic x86_64ï¼‰:\n#include \u0026lt;stdio.h\u0026gt;#include \u0026lt;sys/types.h\u0026gt;#include \u0026lt;sys/wait.h\u0026gt;#include \u0026lt;sys/ptrace.h\u0026gt;#include \u0026lt;unistd.h\u0026gt;#include \u0026lt;sys/user.h\u0026gt; int main(int argc, char **argv) {  int child_pid;  child_pid = fork();  if (child_pid == 0)  {  // `PTRACE_TRACEME` æœ¬è¿›ç¨‹å°†è¢«å…¶çˆ¶è¿›ç¨‹è·Ÿè¸ª(æ­¤æ—¶å‰©ä¸‹çš„`pidã€addrã€data`å‚æ•°éƒ½æ²¡æœ‰å®é™…æ„ä¹‰å¯ä»¥å…¨éƒ¨ä¸º 0)ã€‚  ptrace(PTRACE_TRACEME, 0, 0, 0);  execl(\u0026#34;/bin/ls\u0026#34;,\u0026#34;ls\u0026#34;,NULL); //æ‰§è¡Œç³»ç»Ÿè°ƒç”¨  }  else  {  struct user_regs_struct regs;  wait(NULL);  printf(\u0026#34;child process was stopped ...\u0026#34;);  // è¯»å–å­è¿›ç¨‹å¯„å­˜å™¨é›†  ptrace(PTRACE_GETREGS, child_pid, NULL, \u0026amp;regs);  printf(\u0026#34;%llu\u0026#34;, regs.orig_rax);  // æ¢å¤å­è¿›ç¨‹  ptrace(PTRACE_CONT, child_pid, NULL, NULL);  sleep(1);  }  return 0; } è¸©å‘ SSHD æ³¨å…¥  https://github.com/xpn/ssh-inject\n åˆ†æä¸‹ä»£ç å…¶è¿è¡Œæµç¨‹å›¾æ•´ç†å¦‚ä¸‹ï¼š\ninject.c å’Œ injectme.c ä¸­ä¸€äº›æ³¨å…¥éƒ¨åˆ†ä»£ç ç»†èŠ‚å’Œ hook ä»£ç ç»†èŠ‚å·²ç»çœ‹ä¸æ‡‚äº†ï¼Œå…ˆæŒ–ä¸ªå‘å§\u0026hellip;\nLinux ptrace introduction AKA injecting into sshd for fun åŸåšå®¢ä¸­æœ‰å…³äº ptarce æ­¥éª¤æ›´è¯¦ç»†è¯´æ˜ã€‚\nç¬”è®°ğŸ“’ è¿›ç¨‹ç›¸å…³ï¼š  pid_t fork(void) åœ¨å½“å‰è¿›ç¨‹ä¸‹åˆ†å‰å‡ºå­è¿›ç¨‹ï¼Œå…¶å­è¿›ç¨‹çš„ pid ä¸º 0 pid_t wait (int * status) ç­‰å¾…å­è¿›ç¨‹ä¸­æ–­æˆ–ç»“æŸ pid_t waitpid(pid_t pid, int *status, int options);ï¼ˆç­‰å¾…å­è¿›ç¨‹ä¸­æ–­æˆ–ç»“æŸï¼‰  pid: - pid\u0026lt;-1 ç­‰å¾…è¿›ç¨‹ç»„è¯†åˆ«ç ä¸ºpidç»å¯¹å€¼çš„ä»»ä½•å­è¿›ç¨‹ã€‚ - pid=-1 ç­‰å¾…ä»»ä½•å­è¿›ç¨‹ï¼Œç›¸å½“äºwait()ã€‚ - pid=0 ç­‰å¾…è¿›ç¨‹ç»„è¯†åˆ«ç ä¸ç›®å‰è¿›ç¨‹ç›¸åŒçš„ä»»ä½•å­è¿›ç¨‹ã€‚ - pid\u0026gt;0 ç­‰å¾…ä»»ä½•å­è¿›ç¨‹è¯†åˆ«ç ä¸ºpidçš„å­è¿›ç¨‹ã€‚ status(å­è¿›ç¨‹çš„ç»“æŸçŠ¶æ€è¿”å›åå­˜äºstatusï¼Œåº•ä¸‹æœ‰å‡ ä¸ªå®å¯åˆ¤åˆ«ç»“æŸæƒ…å†µ): - WIFEXITED(status) å¦‚æœå­è¿›ç¨‹æ­£å¸¸ç»“æŸåˆ™ä¸ºé0å€¼ã€‚ - WEXITSTATUS(status) å–å¾—å­è¿›ç¨‹exit()è¿”å›çš„ç»“æŸä»£ç ï¼Œä¸€èˆ¬ä¼šå…ˆç”¨WIFEXITED æ¥åˆ¤æ–­æ˜¯å¦æ­£å¸¸ç»“æŸæ‰èƒ½ä½¿ç”¨æ­¤å®ã€‚ - WIFSIGNALED(status) å¦‚æœå­è¿›ç¨‹æ˜¯å› ä¸ºä¿¡å·è€Œç»“æŸåˆ™æ­¤å®å€¼ä¸ºçœŸ - WTERMSIG(status) å–å¾—å­è¿›ç¨‹å› ä¿¡å·è€Œä¸­æ­¢çš„ä¿¡å·ä»£ç ï¼Œä¸€èˆ¬ä¼šå…ˆç”¨WIFSIGNALED æ¥åˆ¤æ–­åæ‰ä½¿ç”¨æ­¤å®ã€‚ - WIFSTOPPED(status) å¦‚æœå­è¿›ç¨‹å¤„äºæš‚åœæ‰§è¡Œæƒ…å†µåˆ™æ­¤å®å€¼ä¸ºçœŸã€‚ä¸€èˆ¬åªæœ‰ä½¿ç”¨ WUNTRACED æ—¶æ‰ä¼šæœ‰æ­¤æƒ…å†µã€‚ - WSTOPSIG(status) å–å¾—å¼•å‘å­è¿›ç¨‹æš‚åœçš„ä¿¡å·ä»£ç ï¼Œä¸€èˆ¬ä¼šå…ˆç”¨WIFSTOPPED æ¥åˆ¤æ–­åæ‰ä½¿ç”¨æ­¤å®ã€‚ options: å¯ä»¥ä¸º 0 æˆ–ä¸‹é¢çš„ OR ç»„åˆ - WNOHANG å¦‚æœæ²¡æœ‰ä»»ä½•å·²ç»ç»“æŸçš„å­è¿›ç¨‹åˆ™é©¬ä¸Šè¿”å›ï¼Œä¸äºˆä»¥ç­‰å¾…ã€‚ - WUNTRACED å¦‚æœå­è¿›ç¨‹è¿›å…¥æš‚åœæ‰§è¡Œæƒ…å†µåˆ™é©¬ä¸Šè¿”å›ï¼Œä½†ç»“æŸçŠ¶æ€ä¸äºˆä»¥ç†ä¼šã€‚  exec ç³»åˆ—å‡½æ•°ç”¨æ¥æ‰§è¡Œæ–‡ä»¶æˆ–è€…å‘½ä»¤  #include \u0026lt;unistd.h\u0026gt;... int execl(const char *path, const char *arg, ...); int execlp(const char *file, const char *arg, ...); int execle(const char *path, const char *arg, ..., char *const envp[]); int execv(const char *path, char *const argv[]); int execvp(const char *file, char *const argv[]); int execve(const char *path, char *const argv[], char *const envp[]); æ³¨æ„ï¼š ç³»ç»Ÿè°ƒç”¨ exec æ˜¯ä»¥æ–°çš„è¿›ç¨‹å»ä»£æ›¿åŸæ¥çš„è¿›ç¨‹ï¼Œä½†è¿›ç¨‹çš„ PID ä¿æŒä¸å˜ï¼Œåªæ˜¯æ›¿æ¢äº†åŸæ¥è¿›ç¨‹ä¸Šä¸‹æ–‡çš„å†…å®¹ï¼ŒåŸè¿›ç¨‹çš„ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œå †æ ˆæ®µè¢«æ–°çš„è¿›ç¨‹æ‰€ä»£æ›¿ã€‚\nåŠ¨æ€åŠ è½½ åœ¨ dlopen() å‡½æ•°ä»¥æŒ‡å®šæ¨¡å¼æ‰“å¼€æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¥æŸ„ç»™ dlsym() çš„è°ƒç”¨è¿›ç¨‹ã€‚ä½¿ç”¨ dlclose() æ¥å¸è½½æ‰“å¼€çš„åº“ã€‚\n void * dlopen( const char *pathname, int mode ); ï¼šæ‰“å¼€ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚  mode æ˜¯æ‰“å¼€æ–¹å¼ï¼Œå…¶å€¼æœ‰å¤šä¸ªï¼Œä¸åŒæ“ä½œç³»ç»Ÿä¸Šå®ç°çš„åŠŸèƒ½æœ‰æ‰€ä¸åŒï¼Œåœ¨ linux ä¸‹ï¼ŒæŒ‰åŠŸèƒ½å¯åˆ†ä¸ºä¸‰ç±»ï¼š\n è§£ææ–¹å¼  RTLD_LAZYï¼šåœ¨ dlopen() è¿”å›å‰ï¼Œå¯¹äºåŠ¨æ€åº“ä¸­çš„æœªå®šä¹‰çš„ç¬¦å·ä¸æ‰§è¡Œè§£æï¼ˆåªå¯¹å‡½æ•°å¼•ç”¨æœ‰æ•ˆï¼Œå¯¹äºå˜é‡å¼•ç”¨æ€»æ˜¯ç«‹å³è§£æï¼‰ã€‚ RTLD_NOWï¼š éœ€è¦åœ¨ dlopen() è¿”å›å‰ï¼Œè§£æå‡ºæ‰€æœ‰æœªå®šä¹‰ç¬¦å·ï¼Œå¦‚æœè§£æä¸å‡ºæ¥ï¼Œåœ¨ dlopen() ä¼šè¿”å› NULLï¼Œé”™è¯¯ä¸ºï¼š: undefined symbol: xxxx\u0026hellip;\u0026hellip;.   ä½œç”¨èŒƒå›´ï¼Œå¯ä¸è§£ææ–¹å¼é€šè¿‡ | ç»„åˆä½¿ç”¨ã€‚  RTLD_GLOBALï¼šåŠ¨æ€åº“ä¸­å®šä¹‰çš„ç¬¦å·å¯è¢«å…¶åæ‰“å¼€çš„å…¶å®ƒåº“è§£æã€‚ RTLD_LOCALï¼š ä¸ RTLD_GLOBAL ä½œç”¨ç›¸åï¼ŒåŠ¨æ€åº“ä¸­å®šä¹‰çš„ç¬¦å·ä¸èƒ½è¢«å…¶åæ‰“å¼€çš„å…¶å®ƒåº“é‡å®šä½ã€‚å¦‚æœæ²¡æœ‰æŒ‡æ˜æ˜¯ RTLD_GLOBALè¿˜æ˜¯ RTLD_LOCAL ï¼Œåˆ™ç¼ºçœä¸º RTLD_LOCALã€‚   ä½œç”¨æ–¹å¼  RTLD_NODELETEï¼š åœ¨ dlclose() æœŸé—´ä¸å¸è½½åº“ï¼Œå¹¶ä¸”åœ¨ä»¥åä½¿ç”¨ dlopen() é‡æ–°åŠ è½½åº“æ—¶ä¸åˆå§‹åŒ–åº“ä¸­çš„é™æ€å˜é‡ã€‚è¿™ä¸ªflagä¸æ˜¯POSIX-2001æ ‡å‡†ã€‚ RTLD_NOLOADï¼š ä¸åŠ è½½åº“ã€‚å¯ç”¨äºæµ‹è¯•åº“æ˜¯å¦å·²åŠ è½½( dlopen() è¿”å›NULLè¯´æ˜æœªåŠ è½½ï¼Œå¦åˆ™è¯´æ˜å·²åŠ è½½ï¼‰ï¼Œä¹Ÿå¯ç”¨äºæ”¹å˜å·²åŠ è½½åº“çš„flagï¼Œå¦‚ï¼šå…ˆå‰åŠ è½½åº“çš„flagä¸º RTLD_LOCALï¼Œç”¨ dlopen(RTLD_NOLOAD|RTLD_GLOBAL) åflagå°†å˜æˆ RTLD_GLOBAL ã€‚è¿™ä¸ªflagä¸æ˜¯POSIX-2001æ ‡å‡†ã€‚ RTLD_DEEPBINDï¼šåœ¨æœç´¢å…¨å±€ç¬¦å·å‰å…ˆæœç´¢åº“å†…çš„ç¬¦å·ï¼Œé¿å…åŒåç¬¦å·çš„å†²çªã€‚è¿™ä¸ªflagä¸æ˜¯POSIX-2001æ ‡å‡†ã€‚     void * dlsym(void *handle, const char *symbol)ï¼šdlsym() æ ¹æ®åŠ¨æ€é“¾æ¥åº“æ“ä½œå¥æŸ„ handle ä¸ç¬¦å· symbol ï¼Œè¿”å›ç¬¦å·å¯¹åº”çš„åœ°å€ã€‚ä½¿ç”¨è¿™ä¸ªå‡½æ•°ä¸ä½†å¯ä»¥è·å–å‡½æ•°åœ°å€ï¼Œä¹Ÿå¯ä»¥è·å–å˜é‡åœ°å€ã€‚  handle æ˜¯ç”± dlopen() æ‰“å¼€åŠ¨æ€é“¾æ¥åº“åè¿”å›çš„æŒ‡é’ˆï¼Œsymbol å°±æ˜¯è¦æ±‚è·å–çš„å‡½æ•°æˆ–å…¨å±€å˜é‡çš„åç§°ã€‚ è¿”å›å€¼: void* æŒ‡å‘å‡½æ•°çš„åœ°å€ï¼Œä¾›è°ƒç”¨ä½¿ç”¨ã€‚\n  dlclose() ç”¨äºå…³é—­æŒ‡å®šå¥æŸ„çš„åŠ¨æ€é“¾æ¥åº“ï¼Œåªæœ‰å½“æ­¤åŠ¨æ€é“¾æ¥åº“çš„ä½¿ç”¨è®¡æ•°ä¸º 0 æ—¶,æ‰ä¼šçœŸæ­£è¢«ç³»ç»Ÿå¸è½½ã€‚\n  dlerror() å½“åŠ¨æ€é“¾æ¥åº“æ“ä½œå‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶ï¼Œdlerror å¯ä»¥è¿”å›å‡ºé”™ä¿¡æ¯ï¼Œè¿”å›å€¼ä¸º NULL æ—¶è¡¨ç¤ºæ“ä½œå‡½æ•°æ‰§è¡ŒæˆåŠŸã€‚\n  å†…å­˜ç›¸å…³  void * malloc(size_t size)ï¼šåˆ†é…æ‰€éœ€çš„å†…å­˜ç©ºé—´ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘å®ƒçš„æŒ‡é’ˆï¼›è®°å¾—éœ€è¦è¿è¡Œ free(addr` ) void * memcpy(void *dest, const void *src, size_t num);ï¼š ä¼šå¤åˆ¶ src æ‰€æŒ‡çš„å†…å­˜å†…å®¹çš„å‰ num ä¸ªå­—èŠ‚åˆ° dest æ‰€æŒ‡çš„å†…å­˜åœ°å€ä¸Šã€‚  å­—ç¬¦å¤„ç†  int snprintf(char *str, size_t size, const char *format, ...);  è®¾å°†å¯å˜å‚æ•° ... æŒ‰ç…§ format æ ¼å¼åŒ–æˆå­—ç¬¦ä¸²ï¼Œå¹¶å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ° str ä¸­ï¼Œsize ä¸ºè¦å†™å…¥çš„å­—ç¬¦çš„æœ€å¤§æ•°ç›®ï¼Œè¶…è¿‡ size ä¼šè¢«æˆªæ–­ã€‚\n char *strstr(const char *haystack, const char *needle);  åœ¨å­—ç¬¦ä¸² haystack ä¸­æŸ¥æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°å­—ç¬¦ä¸² needle çš„ä½ç½®ï¼Œä¸åŒ…å«ç»ˆæ­¢ç¬¦ \u0026lsquo;\\0\u0026rsquo;ã€‚è¯¥å‡½æ•°è¿”å›åœ¨ haystack ä¸­ç¬¬ä¸€æ¬¡å‡ºç° needle å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› nullã€‚\n unsigned long int strtoul(const char *str, char **endptr, int base);  æŠŠå‚æ•° str æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²æ ¹æ®ç»™å®šçš„ base è½¬æ¢ä¸ºä¸€ä¸ªæ— ç¬¦å·é•¿æ•´æ•°ï¼ˆç±»å‹ä¸º unsigned long int å‹ï¼‰ï¼Œbase å¿…é¡»ä»‹äº 2 å’Œ 36ï¼ˆåŒ…å«ï¼‰ä¹‹é—´ï¼Œæˆ–è€…æ˜¯ç‰¹æ®Šå€¼ 0ã€‚\n int sscanf(const char *str, const char *format, ...); ä»å­—ç¬¦ä¸²è¯»å–æ ¼å¼åŒ–è¾“å…¥ã€‚  å…¶ä»–  struct è¿ç®—ç¬¦ . å’Œç®­å¤´è¿ç®—ç¬¦ -\u0026gt; å¼‚åŒç‚¹ï¼š  ç›¸åŒç‚¹ï¼šä¸¤è€…éƒ½æ˜¯äºŒå…ƒæ“ä½œç¬¦ï¼Œè€Œä¸”å³è¾¹çš„æ“ä½œæ•°éƒ½æ˜¯æˆå‘˜çš„åç§°ã€‚ ä¸åŒç‚¹ï¼šç‚¹è¿ç®—ç¬¦ . çš„å·¦è¾¹æ“ä½œæ•°æ˜¯ä¸€ä¸ªç»“æœä¸ºç»“æ„çš„è¡¨è¾¾å¼ï¼› ç®­å¤´è¿ç®—ç¬¦ -\u0026gt; çš„å·¦è¾¹çš„æ“ä½œæ•°æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆã€‚    æ€»ç»“ æµ…æ˜¾çš„è®¤çŸ¥ Linux ä¸‹è¿›ç¨‹è¿è¡Œçš„æœºåˆ¶ï¼Œptrace çš„å¦‚ä½•åŠ¨æ€æ³¨å…¥åŸºæœ¬è¿‡ç¨‹ï¼ŒCè¯­è¨€çš„åŸºæœ¬ç”¨æ³•ç­‰ã€‚ã€‚ã€‚\nå‚è€ƒæ–‡ç« ğŸ™  linux ptrace wiki linux ptrace æ‰‹å†Œ linux wait waitpid æ‰‹å†Œ ã€ŠLinuxé€†å‘ä¹‹è°ƒè¯•\u0026amp;åè°ƒè¯•ã€‹ ã€ŠLinuxè™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€ä»¥åŠè¿›ç¨‹æ ˆå’Œçº¿ç¨‹æ ˆæ€»ç»“ã€‹ Linux ptrace introduction AKA injecting into sshd for fun https://github.com/xpn/ssh-inject  ","permalink":"https://zznq.imipy.com/posts/linux-ptrace-learning/","title":"Linux ptraceæœºåˆ¶åˆæ¢"},{"content":"å¦‚ä½•ä»£ç† http(s) æµé‡ HTTP ä»£ç†çš„åè®®åŸºäº HTTPï¼Œå› æ­¤ HTTP ä»£ç†æœ¬èº«å°±æ˜¯ä¸€ä¸ª HTTP çš„æœåŠ¡ï¼Œè€Œå…¶å·¥ä½œåŸç†æœ¬è´¨ä¸Šå°±æ˜¯ä¸­é—´äººï¼ˆMITM) ï¼Œå³è¯»å–å½“å‰å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œä»ä»£ç†å‘é€å‡ºå»å¹¶è·å¾—å“åº”ï¼Œç„¶åå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n ä½¿ç”¨ netcat -lv -p 8881 ç›‘å¬ 127.0.0.1:8881\n  è®¿é—® http://**.** nc çš„æ•°æ®åŒ…ä¸º:  GET http://hyuga.co/ HTTP/1.1 Host: hyuga.co Proxy-Connection: keep-alive Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Referer: http://hyuga.co/ Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 ...  è®¿é—® https://**.** nc çš„æ•°æ®åŒ…ä¸º:  CONNECT github.com:443 HTTP/1.1 Host: github.com:443 Proxy-Connection: keep-alive User-Agent: Mozilla/5.0 golang å®ç° http(s) ä»£ç†æœåŠ¡å™¨ ä½¿ç”¨éš§é“ç›´æ¥åŒå‘å¤åˆ¶ https æ•°æ®\npackage main  import ( \t\u0026#34;io\u0026#34; \t\u0026#34;log\u0026#34; \t\u0026#34;net\u0026#34; \t\u0026#34;net/http\u0026#34; )  const addr = \u0026#34;localhost:8881\u0026#34;  func main() { \tlog.Printf(\u0026#34;HTTPProxy is runing on %s \\n\u0026#34;, addr) \tlog.Fatalln(http.ListenAndServe(addr, http.HandlerFunc(handler))) }  func handler(rw http.ResponseWriter, req *http.Request) { \t// http \u0026amp;\u0026amp; https \tif req.Method != \u0026#34;CONNECT\u0026#34; { \t// å¤„ç†http \thandleHTTP(rw, req) \t} else { \t// å¤„ç†https \thandleHTTPS(rw, req) \t} }  func handleHTTP(rw http.ResponseWriter, req *http.Request) { \ttransport := http.DefaultTransport \t// æ–°å»ºä¸€ä¸ªè¯·æ±‚outReq \toutReq := new(http.Request) \t// å¤åˆ¶å®¢æˆ·ç«¯è¯·æ±‚åˆ°outReqä¸Š \t*outReq = *req // å¤åˆ¶è¯·æ±‚ \t// outReq è¯·æ±‚æ”¾åˆ°ä¼ é€ä¸Š \tres, err := transport.RoundTrip(outReq) \tif err != nil { \trw.WriteHeader(http.StatusBadGateway) \trw.Write([]byte(err.Error())) \treturn \t} \t// å›å†™ http å¤´ \tfor key, value := range res.Header { \tfor _, v := range value { \trw.Header().Add(key, v) \t} \t} \t// å›å†™çŠ¶æ€ç  \trw.WriteHeader(res.StatusCode) \t// å›å†™ body \tio.Copy(rw, res.Body) \tres.Body.Close() }  func handleHTTPS(rw http.ResponseWriter, req *http.Request) { \thost := req.URL.Host \thij, ok := rw.(http.Hijacker) \tif !ok { \tlog.Printf(\u0026#34;HTTP Server does not support hijacking\u0026#34;) \t} \tclient, _, err := hij.Hijack() \tif err != nil { \treturn \t} \t// è¿æ¥è¿œç¨‹ \tserver, err := net.Dial(\u0026#34;tcp\u0026#34;, host) \tif err != nil { \treturn \t} \tclient.Write([]byte(\u0026#34;HTTP/1.0 200 Connection Established\\r\\n\\r\\n\u0026#34;)) \t// ç›´é€šåŒå‘å¤åˆ¶ \tgo io.Copy(server, client) \tgo io.Copy(client, server) } ä½†ä½œä¸ºè¢«åŠ¨æ‰«æå™¨çš„ä»£ç†ï¼Œhttps åè®®çš„è¯·æ±‚æ•°æ®éƒ½æ˜¯åŠ å¯†çš„ï¼Œå¤§éƒ¨åˆ†çš„ç½‘ç«™éƒ½æ— æ³•è¿›è¡Œæ¼æ´æ£€æµ‹äº†ï¼Œæ‰€ä»¥è¢«åŠ¨æ‰«æå™¨çš„ä»£ç†è¿˜éœ€è¦å¯¹ https æµé‡è¿›è¡ŒåŠ è§£å¯†ã€‚\nHTTP \u0026amp; HTTPS çš„åŒºåˆ«   HTTP åè®®ä»¥æ˜æ–‡æ–¹å¼å‘é€å†…å®¹ï¼Œä¸æä¾›ä»»ä½•æ–¹å¼çš„æ•°æ®åŠ å¯†ï¼Œå¦‚æœæ”»å‡»è€…æˆªå–äº†Webæµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“æŠ¥æ–‡ï¼Œå°±å¯ä»¥ç›´æ¥è¯»æ‡‚å…¶ä¸­çš„ä¿¡æ¯ï¼Œå› æ­¤ï¼ŒHTTPåè®®ä¸é€‚åˆä¼ è¾“ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šä¿¡ç”¨å¡å·ã€å¯†ç ç­‰æ”¯ä»˜ä¿¡æ¯ã€‚\n  HTTPSï¼ˆHypertext Transfer Protocol Secureï¼šè¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼‰æ˜¯ä¸€ç§é€è¿‡è®¡ç®—æœºç½‘ç»œè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ã€‚HTTPS ç»ç”± HTTP è¿›è¡Œé€šä¿¡ï¼Œä½†åˆ©ç”¨ SSL/TLS æ¥åŠ å¯†æ•°æ®åŒ…ã€‚HTTPS å¼€å‘çš„ä¸»è¦ç›®çš„ï¼Œæ˜¯æä¾›å¯¹ç½‘ç«™æœåŠ¡å™¨çš„èº«ä»½è®¤è¯ï¼Œä¿æŠ¤äº¤æ¢æ•°æ®çš„éšç§ä¸å®Œæ•´æ€§ã€‚\n  HTTPS é»˜è®¤å·¥ä½œåœ¨ TCP åè®®443ç«¯å£ï¼Œå®ƒçš„å·¥ä½œæµç¨‹ä¸€èˆ¬å¦‚ä»¥ä¸‹æ–¹å¼ï¼š\n TCP ä¸‰æ¬¡åŒæ­¥æ¡æ‰‹ å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨æ•°å­—è¯ä¹¦ DH ç®—æ³•åå•†å¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥ã€hash ç®—æ³•çš„å¯†é’¥ SSL å®‰å…¨åŠ å¯†éš§é“åå•†å®Œæˆ ç½‘é¡µä»¥åŠ å¯†çš„æ–¹å¼ä¼ è¾“ï¼Œç”¨åå•†çš„å¯¹ç§°åŠ å¯†ç®—æ³•å’Œå¯†é’¥åŠ å¯†ï¼Œä¿è¯æ•°æ®æœºå¯†æ€§ï¼›ç”¨åå•†çš„hashç®—æ³•è¿›è¡Œæ•°æ®å®Œæ•´æ€§ä¿æŠ¤ï¼Œä¿è¯æ•°æ®ä¸è¢«ç¯¡æ”¹ã€‚  ä»€ä¹ˆæ˜¯è¯ä¹¦ æœ€é¡¶å±‚çš„ Global Sign RootCA æ˜¯ä¸€ä¸ªæ ¹è¯ä¹¦ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªä¸­é—´è¯ä¹¦ï¼Œæœ€åä¸€ä¸ªæ‰æ˜¯ç”¨æˆ·çš„é¢å‘è¯ä¹¦ï¼Œè¿™ä¸‰ç§è¯ä¹¦çš„æ•ˆåŠ›æ˜¯:\nRootCA \u0026gt; Intermediates CA \u0026gt; End-User Cert  è€Œä¸”åªè¦ä¿¡ä»»äº† RootCA ç”± RootCA ç­¾å‘çš„åŒ…æ‹¬å…¶ä¸‹çº§ç­¾å‘çš„è¯ä¹¦éƒ½ä¼šè¢«ä¿¡ä»»ã€‚è€Œ Global Sign RootCA ç­‰æ˜¯ä¸€äº›é»˜è®¤å®‰è£…åœ¨ç³»ç»Ÿå’Œæµè§ˆå™¨ä¸­çš„æ ¹è¯ä¹¦ã€‚è¿™äº›è¯ä¹¦ç”±ä¸€äº›æƒå¨æœºæ„æ¥ç»´æŠ¤ï¼Œå¯ä»¥ç¡®ä¿è¯ä¹¦çš„å®‰å…¨å’Œæœ‰æ•ˆæ€§ã€‚è€Œå†…ç½®çš„è¿™äº›æ ¹è¯ä¹¦å°±å…è®¸æˆ‘ä»¬è®¿é—®ä¸€äº›å…¬å…±çš„ç½‘ç«™è€Œæ— éœ€æ‰‹åŠ¨ä¿¡ä»»è¯ä¹¦äº†ã€‚\nä»€ä¹ˆæ˜¯x509è¯ä¹¦é“¾ x509è¯ä¹¦ä¸€èˆ¬ä¼šç”¨åˆ°ä¸‰ç±»æ–‡ä»¶ï¼Œkeyï¼Œcsrï¼Œcrtã€‚\nKey æ˜¯ç§ç”¨å¯†é’¥ï¼Œopenssl æ ¼å¼ï¼Œé€šå¸¸æ˜¯ rsa ç®—æ³•ã€‚\ncsr æ˜¯è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œç”¨äºç”³è¯·è¯ä¹¦ã€‚åœ¨åˆ¶ä½œ csr æ–‡ä»¶çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥ç­¾ç½²ç”³è¯·ï¼Œè¿˜å¯ä»¥è®¾å®šä¸€ä¸ªå¯†é’¥ã€‚\ncrt æ˜¯ CA è®¤è¯åçš„è¯ä¹¦æ–‡ä»¶ï¼Œç­¾ç½²äººç”¨è‡ªå·±çš„keyç»™ä½ ç­¾ç½²çš„å‡­è¯ã€‚\nå¦‚ä½•ç”Ÿæˆè¯ä¹¦ openssl ä¸­æœ‰å¦‚ä¸‹åç¼€åçš„æ–‡ä»¶\n .keyæ ¼å¼ï¼šç§æœ‰çš„å¯†é’¥ .csræ ¼å¼ï¼šè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆè¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼‰ï¼Œå«æœ‰å…¬é’¥ä¿¡æ¯ï¼Œcertificate signing requestçš„ç¼©å†™ .crtæ ¼å¼ï¼šè¯ä¹¦æ–‡ä»¶ï¼Œcertificateçš„ç¼©å†™ .crlæ ¼å¼ï¼šè¯ä¹¦åŠé”€åˆ—è¡¨ï¼ŒCertificate Revocation Listçš„ç¼©å†™ .pemæ ¼å¼ï¼šç”¨äºå¯¼å‡ºï¼Œå¯¼å…¥è¯ä¹¦æ—¶å€™çš„è¯ä¹¦çš„æ ¼å¼ï¼Œæœ‰è¯ä¹¦å¼€å¤´ï¼Œç»“å°¾çš„æ ¼å¼  ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆè¯ä¹¦ï¼š\nopenssl genrsa -out ca/rootCA.key 2048 openssl req -new -key ca/rootCA.key -out ca/rootCA.csr openssl x509 -req -days 3650 -in ca/rootCA.csr -signkey ca/rootCA.key -in rootCA.csr -out ca/rootCA.crt å¦‚ä½•ä¿¡ä»»è¯ä¹¦ åªåˆ—ä¸¾äº† MacOS ä¸‹çš„æƒ…å†µï¼ˆå…¶ä»–æ“ä½œç³»ç»Ÿè‡ªè¡Œæœç´¢ï¼š\n ä½¿ç”¨å‘½ä»¤  sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ca/rootCA.crt  æ‰“å¼€â€œé’¥åŒ™ä¸²è®¿é—®â€ï¼›ç³»ç»Ÿ-\u0026gt;è¯ä¹¦-\u0026gt;æ·»åŠ ï¼›åŒå‡»æ·»åŠ çš„è¯ä¹¦-\u0026gt;ä¿¡ä»»-\u0026gt;å§‹ç»ˆä¿¡ä»»ã€‚  golang å¦‚ä½•ä»£ç†å¹¶è§£å¯† https æµé‡ æŒ‘é€‰ä¸€ä¸ªè½»é‡ goproxy é¡¹ç›®è¿›è¡Œæºç åˆ†æï¼š\nè¯ä¹¦ç›¸å…³ï¼š\n// Cache è¯ä¹¦ç¼“å­˜æ¥å£ type Cache interface { \tSet(host string, c *tls.Certificate) \tGet(host string) *tls.Certificate } //è¯ä¹¦ struct type Certificate struct { \tcache Cache } // NewCertificate åˆ›å»ºè¯ä¹¦ func NewCertificate(cache Cache) *Certificate { \treturn \u0026amp;Certificate{ \tcache: cache, \t} } GenerateTlsConfig æ ¹æ®æ ¹è¯ä¹¦ç”Ÿæˆå­è¯ä¹¦ï¼Œå¹¶å†™å…¥ cache ä¸­\n// GenerateTlsConfig ç”ŸæˆTLSé…ç½® func (c *Certificate) GenerateTlsConfig(host string) (*tls.Config, error) { \tif h, _, err := net.SplitHostPort(host); err == nil { \thost = h \t} \tif c.cache != nil { \t// å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾è¯ä¹¦ \tif cert := c.cache.Get(host); cert != nil { \ttlsConf := \u0026amp;tls.Config{ \tCertificates: []tls.Certificate{*cert}, \t}  \treturn tlsConf, nil \t} \t} \tpair, err := c.GeneratePem(host, 1, defaultRootCA, defaultRootKey) \tif err != nil { \treturn nil, err \t} \tcert, err := tls.X509KeyPair(pair.CertBytes, pair.PrivateKeyBytes) \tif err != nil { \treturn nil, err \t} \ttlsConf := \u0026amp;tls.Config{ \tCertificates: []tls.Certificate{cert}, \t}  \tif c.cache != nil { \t// ç¼“å­˜è¯ä¹¦ \tc.cache.Set(host, \u0026amp;cert) \t}  \treturn tlsConf, nil } å…ˆå®šä½åˆ° server handler æ–¹æ³•ï¼š\nfunc (p *Proxy) ServeHTTP(rw http.ResponseWriter, req *http.Request) { \t... \tctx := \u0026amp;Context{ \tReq: req, \tData: make(map[interface{}]interface{}), \t} \t... \tswitch { \tcase ctx.Req.Method == http.MethodConnect \u0026amp;\u0026amp; p.decryptHTTPS: \tp.forwardHTTPS(ctx, rw) \tcase ctx.Req.Method == http.MethodConnect: \tp.forwardTunnel(ctx, rw) \tdefault: \tp.forwardHTTP(ctx, rw) \t} }  forwardHTTPS: è§£å¯† https è¯·æ±‚ forwardTunnel: éš§é“ç›´è¿ forwardHTTP: å¤„ç†æ™®é€š http è¯·æ±‚  forwardHTTPS æ–¹æ³•:\n// HTTPSè½¬å‘ func (p *Proxy) forwardHTTPS(ctx *Context, rw http.ResponseWriter) { \tvar err error \t// è·å–åº•å±‚è¿æ¥ \thijacker, ok := rw.(http.Hijacker) \tif !ok { \terr = fmt.Errorf(\u0026#34;web serverä¸æ”¯æŒHijacker\u0026#34;) \t} \tclientConn, _, err := hijacker.Hijack() \tif err != nil { \terr = fmt.Errorf(\u0026#34;hijackeré”™è¯¯: %s\u0026#34;, err) \t} \t// handler errors \tif err != nil { \tp.delegate.ErrorLog(err) \trw.WriteHeader(http.StatusBadGateway) \treturn \t} \tdefer clientConn.Close() \t\t// éš§é“è¿æ¥æˆåŠŸå“åº”è¡Œ \t_, err = clientConn.Write([]byte(\u0026#34;HTTP/1.1 200 Connection established\\r\\n\\r\\n\u0026#34;)) \tif err != nil { \tp.delegate.ErrorLog(fmt.Errorf(\u0026#34;%s - HTTPSè§£å¯†, é€šçŸ¥å®¢æˆ·ç«¯éš§é“å·²è¿æ¥å¤±è´¥, %s\u0026#34;, ctx.Req.URL.Host, err)) \treturn \t} \t// è·å–å­è¯ä¹¦ \ttlsConfig, err := p.cert.GenerateTlsConfig(ctx.Req.URL.Host) \tif err != nil { \tp.delegate.ErrorLog(fmt.Errorf(\u0026#34;%s - HTTPSè§£å¯†, ç”Ÿæˆè¯ä¹¦å¤±è´¥: %s\u0026#34;, ctx.Req.URL.Host, err)) \trw.WriteHeader(http.StatusBadGateway) \treturn \t} \t// è·å–ä¸€ä¸ª TLS Server æ–°è¿æ¥ \ttlsClientConn := tls.Server(clientConn, tlsConfig) \ttlsClientConn.SetDeadline(time.Now().Add(defaultClientReadWriteTimeout)) \tdefer tlsClientConn.Close() \tif err := tlsClientConn.Handshake(); err != nil { \tp.delegate.ErrorLog(fmt.Errorf(\u0026#34;%s - HTTPSè§£å¯†, æ¡æ‰‹å¤±è´¥: %s\u0026#34;, ctx.Req.URL.Host, err)) \treturn \t} \t// è§£å¯† https reqeust \tbuf := bufio.NewReader(tlsClientConn) \ttlsReq, err := http.ReadRequest(buf) \tif err != nil { \tif err != io.EOF { \tp.delegate.ErrorLog(fmt.Errorf(\u0026#34;%s - HTTPSè§£å¯†, è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤±è´¥: %s\u0026#34;, ctx.Req.URL.Host, err)) \t} \treturn \t} \ttlsReq.RemoteAddr = ctx.Req.RemoteAddr \ttlsReq.URL.Scheme = \u0026#34;https\u0026#34; \ttlsReq.URL.Host = tlsReq.Host  \tctx.Req = tlsReq \tp.DoRequest(ctx, func(resp *http.Response, err error) { \tif err != nil { \tp.delegate.ErrorLog(fmt.Errorf(\u0026#34;%s - HTTPSè§£å¯†, è¯·æ±‚é”™è¯¯: %s\u0026#34;, ctx.Req.URL, err)) \ttlsClientConn.Write(badGateway) \treturn \t} \t// å†™å…¥ response \terr = resp.Write(tlsClientConn) \tif err != nil { \tp.delegate.ErrorLog(fmt.Errorf(\u0026#34;%s - HTTPSè§£å¯†, responseå†™å…¥å®¢æˆ·ç«¯å¤±è´¥, %s\u0026#34;, ctx.Req.URL, err)) \t} \tresp.Body.Close() \t}) } DoRequest æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š\n// DoRequest æ‰§è¡ŒHTTPè¯·æ±‚ï¼Œå¹¶è°ƒç”¨responseFuncå¤„ç†response func (p *Proxy) DoRequest(ctx *Context, responseFunc func(*http.Response, error)) { \tif ctx.Data == nil { \tctx.Data = make(map[interface{}]interface{}) \t} \tif ctx.abort { \treturn \t} \tnewReq := new(http.Request) \t*newReq = *ctx.Req \tnewReq.Header = CloneHeader(newReq.Header) \tremoveConnectionHeaders(newReq.Header) \tfor _, item := range hopHeaders { \tif newReq.Header.Get(item) != \u0026#34;\u0026#34; { \tnewReq.Header.Del(item) \t} \t} \tresp, err := p.transport.RoundTrip(newReq) \tif ctx.abort { \treturn \t} \tif err == nil { \tremoveConnectionHeaders(resp.Header) \tfor _, h := range hopHeaders { \tresp.Header.Del(h) \t} \t} \tresponseFunc(resp, err) } å¦‚ä¸Šï¼Œå®Œæˆè¿™ä¸€ https è§£å¯†è¿‡ç¨‹è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå½“ç„¶åƒã€ŠHTTPè¢«åŠ¨æ‰«æä»£ç†çš„é‚£äº›äº‹ã€‹ä¸­è¯´çš„â€œ#ç¦»å®Œç¾çš„å·®è·â€œï¼Œè¿™æ¬¡çš„åˆæ¢æ˜¯ä¸ºäº†æ»¡è¶³å¯¹è¢«åŠ¨æ‰«æå™¨ä»£ç†éƒ¨åˆ†çš„å¥½å¥‡ğŸ¤”ã€‚ã€‚ã€‚\nå‚è€ƒæ–‡ç«   ã€Šæ·±å…¥ç†è§£HTTPSå·¥ä½œåŸç†ã€‹https://juejin.cn/post/6844903830916694030 ã€ŠHTTPè¢«åŠ¨æ‰«æä»£ç†çš„é‚£äº›äº‹ã€‹https://www.freebuf.com/articles/web/212382.html ã€ŠHTTP ä¸ HTTPS çš„åŒºåˆ«ã€‹https://www.runoob.com/w3cnote/http-vs-https.html ã€Šåˆ«é—¹ï¼è‡ªç­¾åè¯ä¹¦ï¼ã€‹https://zhuanlan.zhihu.com/p/41501360 ã€ŠLinuxä¸“é¢˜â€”Opensslç”Ÿæˆè¯ä¹¦ã€‹https://zhuanlan.zhihu.com/p/104212822 https://github.com/ouqiang/goproxy  ","permalink":"https://zznq.imipy.com/posts/passive-scanner-https-proxy/","title":"è¢«åŠ¨æ‰«æå™¨HTTP(S)ä»£ç†åˆæ¢"},{"content":"è™½ç„¶ä¹‹å‰æœ‰ç”¨ React ç¼–å†™äº† Hyuga çš„å‰ç«¯ï¼Œä½†æ˜¯éƒ½æ˜¯é çš„ google + github è§£å†³çš„ï¼Œè®¤çŸ¥å¾ˆæµ…ã€‚\nå‰ç«¯åŸºç¡€  https://developer.mozilla.org/zh-CN/ åˆ«è¯´äº†å°±æ˜¯å¤šçœ‹æ–‡æ¡£\n HTML  å—çº§å…ƒç´  è‡ªå ä¸€è¡Œ å†…è”å…ƒç´ çš„å¤§å°å°±æ˜¯è¢«åŒ…è£¹å…ƒç´ çš„å¤§å° \u0026lt;head\u0026gt; ä¸­çš„ \u0026lt;base target=\u0026quot;_blank\u0026quot; /\u0026gt; å®šä¹‰æ‰€æœ‰çš„é“¾æ¥å±æ€§  CSS åŸºç¡€  https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference#%E5%85%B3%E9%94%AE%E5%AD%97%E7%B4%A2%E5%BC%95\n è½½å…¥ CSS çš„å‡ ç§æ–¹æ³•  å†…è” inline Style æ ‡ç­¾ ç‹¬ç«‹æ–‡ä»¶  css é€‰æ‹©å™¨ https://segmentfault.com/a/1190000013424772\nå¸¸ç”¨çš„é€‰æ‹©å™¨ï¼š\n  å…ƒç´ é€‰æ‹©å™¨\np{...} div{...} ç­‰\n  ç±»é€‰æ‹©å™¨\n.class_name{...}\n  ID é€‰æ‹©å™¨ #id_name{...}\n  å±æ€§é€‰æ‹©å™¨\na[id=\u0026quot;xxx\u0026quot;]{...}\n  ä¼ªå…ƒç´ é€‰æ‹©å™¨\n.content::after{...}\n  ä¼ªç±»é€‰æ‹©å™¨\na:link{...}\n  a æ ‡ç­¾:\n link: åŸæ¥çš„é¢œè‰² active: ç‚¹å‡»æ—¶ visited: ç‚¹å‡»å hover: é¼ æ ‡ç§»è‡³é“¾æ¥(focus)  a:link {  color: green; } a:active {  color: black; } a:visited {  color: orange; } a:hover {  color: yellow; } æ ‡ç­¾ç»„åˆ\n A \u0026gt; Bï¼šé€‰æ‹© A ä¸‹ä¸€å±‚çš„å…ƒç´  B A ~ Bï¼šé€‰æ‹©ä¸ A åŒçˆ¶å±‚çš„å…ƒç´  B A + Bï¼šé€‰æ‹©ä¸ A ç›¸é‚»çš„å…ƒç´  B(ä¸èƒ½è¢«ä»»ä½•å…ƒç´ ç›¸éš”) A Bï¼šåŒ…å«é€‰æ‹©ï¼ŒA å…ƒç´ ä¸‹æ‰€æœ‰çš„ B å…ƒç´   å¸¸è§çš„ CSS å­—ä½“ å­—ä½“æ ·å¼ï¼ˆä½¿ç”¨ç³»ç»Ÿå­—ä½“æ ·å¼ï¼‰\nbody {  font-family: -apple-system, BlinkMacSystemFont, \u0026#34;Segoe UI\u0026#34;, Roboto,  \u0026#34;Helvetica Neue\u0026#34;, Helvetica, \u0026#34;PingFang SC\u0026#34;, \u0026#34;Hiragino Sans GB\u0026#34;,  \u0026#34;Microsoft YaHei\u0026#34;, SimSun, sans-serif; } /* é¢œè‰² */ h2 {  color: #4d9ef8; } /* æ–‡å­—å¯¹é½ */ h2 {  text-align: center; } /* æ–‡å­—è£…é¥° */ h2 {  text-decoration: underline; } /* é¦–è¡Œç¼©è¿› */ p {  text-indent: 20px; } /* è¡Œé—´è· */ p {  line-height: 1.8; } /* å­—é—´è· */ h2 {  letter-spacing: 5px; } æ¢è¡Œ ä¸­æ–‡ä¸è‹±æ–‡åœ¨è¶…é•¿çš„æƒ…å†µä¸‹ä¼šè‡ªåŠ¨æ¢è¡Œï¼›\ndiv.bg {  word-wrap: break-word; } Box æ¨¡å‹ Box æ¨¡å‹æº¢å‡º\n éšè— overflow:hidden è‡ªåŠ¨æ·»åŠ æ»šåŠ¨æ¡ overflow:auto æ€»æ˜¯æ˜¾ç¤ºæ»šåŠ¨æ¡ overflow:scroll æ°´å¹³ä¸å‚ç›´æ–¹å‘ overflow-x, overflow-y  Position JavaScript ç‰ˆæœ¬ç‰¹å¾:\n   ECMAScript ç‰ˆæœ¬ å‘å¸ƒæ—¶é—´ æ–°å¢ç‰¹æ€§     ECMAScript 2009(ES5) 2009.11 æ‰©å±•äº† Objectã€Arrayã€Function çš„åŠŸèƒ½ç­‰   ECMAScript 2015(ES6) 2015.6 ç±»ï¼Œæ¨¡å—åŒ–ï¼Œç®­å¤´å‡½æ•°ï¼Œå‡½æ•°å‚æ•°é»˜è®¤å€¼ç­‰   ECMAScript 2016(ES7) 2016.3 incluedsï¼ŒæŒ‡æ•°æ“ä½œç¬¦   ECMAScript 2017(ES8) 2017.6 sync/await, Object.values(), Object.entries(), String padding ç­‰    æµè§ˆå™¨å¯¹ Es6 å„ç§ç‰¹æ€§æ”¯æŒçš„å›¾è¡¨ http://kangax.github.io/compat-table/es6/\næ•°æ®ç±»å‹ï¼š\n   ç±»å‹ desc     æ•°å€¼ æ•´å‹ã€æµ®ç‚¹ã€åŒç²¾åº¦ã€isNaN   å­—ç¬¦ä¸² \u0026ldquo;åŒå¼•å·\u0026rdquo;ã€ \u0026lsquo;å•å¼•å·\u0026rsquo;   æ•°ç»„ [var1, va2]   å¯¹è±¡ {key: \u0026ldquo;value\u0026rdquo;}   å¼±ç±»å‹ typeofã€parseIntã€parseFloat    å˜é‡å®šä¹‰ï¼š\n å…¨å±€ï¼švar ä½œç”¨åŸŸï¼šletå˜é‡ \u0026amp; constå¸¸é‡ è§£æ„èµ‹å€¼ï¼šlet{a,b} = {a:1, b:2}  æ“ä½œç¬¦ï¼š\n ç®—æœ¯è¿ç®—ï¼šåŠ å‡ä¹˜é™¤ã€++/\u0026ndash;ã€+=ã€å–æ¨¡ æ¯”è¾ƒè¿ç®—ï¼š\u0026gt;ã€\u0026lt;ã€!=ã€==ã€ !==ã€ ===ã€ ? é€»è¾‘è¿ç®—ï¼š\u0026amp;\u0026amp;ã€||ã€! ä½è¿ç®—ï¼š\u0026amp;ã€|ã€\u0026raquo;ã€\u0026laquo; å­—ç¬¦ä¸²è¿ç®—ï¼š+  é¢å‘å¯¹è±¡ï¼š class salaryData{  // æ„é€ å‡½æ•°  constructor( city , position , salary_max , salary_min ){  this.city = city;  this.position = position;  this.salary_max = salary_max;  this.salary_min = salary_min;  }  // æ–¹æ³•  avg_salary(){  return (this.salary_min + this.salary_max)/2;  } } // make new let sh_fe = new salaryData( \u0026#39;shanghai\u0026#39; , \u0026#39;fe\u0026#39; , 14398 , 24675 ); console.log( sh_fe.avg_salary() );  // ç»§æ‰¿ class capitalSalaryData extends salaryData{  constructor( city , position , salary_max , salary_min ){ // è°ƒç”¨çˆ¶ç±»  super( city , position , salary_max , salary_min );  }  pure_income(){  return this.avg_salary()*0.55;  } } å…¬æœ‰ã€ç§æœ‰ã€ä¿æŠ¤å±æ€§å’Œæ–¹æ³• çº¦å®šï¼šå¯ä»¥ä½¿ç”¨ _, __ å­—ç¬¦ä¸ºå‰ç¼€\ngetter / setter class salaryData{  constructor( city , position , salary_max , salary_min ){  this.city = city;  this.position = position;  this.salary_max = salary_max;  this.salary_min = salary_min;  }  get avg_salary(){  return (this.salary_min + this.salary_max)/2;  }  get pure_income(){  return this.avg_salary()*0.55;  } } // make new let sh_fe = new salaryData( \u0026#39;shanghai\u0026#39; , \u0026#39;fe\u0026#39; , 14398 , 24675 ); console.log( sh_fe.avg_salary ); setter: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/set\nthis å’Œ ç®­å¤´å‡½æ•° // åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œthis æŒ‡ä»£çš„æ˜¯ window // å‡½æ•°ä¸­é»˜è®¤è°ƒç”¨ï¼Œä½¿ç”¨å…¨å±€ä¸Šä¸‹æ–‡ function testThis(o){  console.log(this.title); } testThis(); // ä½¿ç”¨ call æˆ–è€… applyï¼Œå¼ºåˆ¶ this ä½¿ç”¨å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œè¿™æ—¶ this === o testThis.call({title:\u0026#34;title1\u0026#34;}); testThis.apply({title:\u0026#34;title2\u0026#34;}); // ES5 å¼•å…¥ bind æ–¹æ³•ï¼Œå¯ä»¥åŠ¨æ€çš„ä»ä¸€ä¸ªæ—§å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¹¶æŠŠè¿™ä¸ªå‡½æ•°çš„ thisï¼Œç»‘å®šåˆ° bind çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸Š testThis.bind({title:\u0026#34;title3\u0026#34;})();  // åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œthis ä¿ç•™å¤–éƒ¨çš„ä¸Šä¸‹æ–‡çš„å€¼ã€‚ var testThis1 = () =\u0026gt; {console.log(this.title)}; testThis1(); // å…¶ä»–è°ƒç”¨æ–¹å¼éƒ½æ— æ³•æ”¹å˜ testThis1({title:\u0026#34;title4\u0026#34;}); testThis1.call({title:\u0026#34;title4\u0026#34;}); testThis1.bind({title:\u0026#34;title4\u0026#34;})();  // é€šè¿‡å¯¹è±¡.æ–¹æ³•() æ¥è°ƒç”¨æ—¶ï¼Œthis ä¼šç»‘å®šå¯¹è±¡ä¸Šã€‚ var book = new Object; book.name = \u0026#34;ã€Šå¯Œçˆ¸çˆ¸ï¼Œç©·çˆ¸çˆ¸ã€‹\u0026#34;; book.read = function(){  console.log(this.name); } book.read(); æ¨¡å—ä¸åŒ… ES6 å JavaScript å¼€å§‹æ”¯æŒé€šè¿‡ import æ¥å¯¼å…¥å…¶ä»–çš„æ¨¡å—\n module, export, import  DOM window åœ¨æµè§ˆå™¨é‡Œè¿è¡Œ JavaScript é»˜è®¤å¯¹è±¡å°±æ˜¯ window ä½¿ç”¨å…¶å±æ€§ä¸æ–¹æ³•æ—¶å¯çœç•¥æ‰ window. ã€‚\n åœ°å€æ ï¼šlocation.href, location.reload äº¤äº’æ“ä½œï¼šalert, confirm, prompt å¤§å°å’Œä½ç½®ï¼š outerHeight, outerWidth, innerHeight, innerWidth æ»šåŠ¨ï¼šscroll, scrollBy, scrollTo, scrollX, scrollY çª—å£ï¼šopen, opener, parent  event äº‹ä»¶ https://devdocs.io/dom_events/\nJQuery ä¸­æ–‡æ–‡æ¡£ï¼šhttps://www.jquery123.com/\nNode ä¸­æ–‡æ–‡æ¡£ï¼šhttp://nodejs.cn/\nç¼–å†™ç®€å•çš„ WebServer Demo:\nconst http = require(\u0026#34;http\u0026#34;); const path = require(\u0026#34;path\u0026#34;); const fs = require(\u0026#34;fs\u0026#34;);  const server = http.createServer();  server.on(\u0026#34;request\u0026#34;, (req, resp) =\u0026gt; {  const ext = path.extname(req.url);  let doc_path = path.join(__dirname, \u0026#34;root\u0026#34;, req.url);  console.log(req.url, doc_path);  let content;  let status = 200;  let mime = { \u0026#34;Content-Type\u0026#34;: \u0026#34;text/html\u0026#34; };  switch (ext) {  case \u0026#34;.html\u0026#34;:  case \u0026#34;.htm\u0026#34;:  mime = { \u0026#34;Content-Type\u0026#34;: \u0026#34;text/html\u0026#34; };  break;  case \u0026#34;.css\u0026#34;:  mime = { \u0026#34;Content-Type\u0026#34;: \u0026#34;text/css\u0026#34; };  break;  case \u0026#34;.ico\u0026#34;:  mime = { \u0026#34;Content-Type\u0026#34;: \u0026#34;image/x-icon\u0026#34; };  break;  }   if (ext != \u0026#34;\u0026#34; \u0026amp;\u0026amp; fs.existsSync(doc_path)) {  content = fs.readFileSync(doc_path);  } else {  status = 404;  content = \u0026#34;æ–‡ä»¶ä¸å­˜åœ¨\u0026#34;;  }  resp.writeHead(status, mime);  resp.write(content);  resp.end(); });  server.listen(8080); NodeJS çš„åŸºæœ¬ç»“æ„ React Export å­˜åœ¨ä¸¤ç§ exports å¯¼å‡ºæ–¹å¼ï¼š\n å‘½åå¯¼å‡ºï¼ˆæ¯ä¸ªæ¨¡å—åŒ…å«ä»»æ„æ•°é‡ï¼‰ é»˜è®¤å¯¼å‡ºï¼ˆæ¯ä¸ªæ¨¡å—åŒ…å«ä¸€ä¸ªï¼‰(æ³¨æ„ï¼Œä¸èƒ½ä½¿ç”¨ varã€let æˆ– const ç”¨äºå¯¼å‡ºé»˜è®¤å€¼ export defaultã€‚)  åœ¨å¯¼å‡ºå¤šä¸ªå€¼æ—¶ï¼Œå‘½åå¯¼å‡ºéå¸¸æœ‰ç”¨ã€‚åœ¨å¯¼å…¥æœŸé—´ï¼Œå¿…é¡»ä½¿ç”¨ç›¸åº”å¯¹è±¡çš„ç›¸åŒåç§°ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•åç§°å¯¼å…¥é»˜è®¤å¯¼å‡ºã€‚\nImport ä¸€ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ constructorï¼šæ„é€ å‡½æ•° componentDidMountï¼šç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶çš„æŒ‚è½½ componentWillUnmountï¼šç»„ä»¶è¢«åˆ é™¤æ—¶çš„å¸è½½\næ­£ç¡®çš„æ›´æ–° stateï¼šhttps://zh-hans.reactjs.org/docs/state-and-lifecycle.html#using-state-correctly\nå…³äºç»„ä»¶æ•°æ®æµï¼šhttps://zh-hans.reactjs.org/docs/state-and-lifecycle.html#the-data-flows-down\n","permalink":"https://zznq.imipy.com/posts/frontend-learning/","title":"å‰ç«¯å…¥é—¨å°è®°"}]